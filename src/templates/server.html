<!-- ==================== ‰∏ªÊú∫ÁÆ°ÁêÜÈÉ®ÂàÜ ==================== -->
<div class="tab-content server-tab-content theme-server" :class="[getTabAnimationClass('server')]">
  <!-- ‰∏ªÊú∫Â≠êÊ†áÁ≠æÈ°µ -->
  <div class="sec-tabs server-sec-tabs">
    <div class="server-tabs-scroll-wrapper">
      <button class="tab-btn" :class="{ active: serverCurrentTab === 'list' }" @click="serverCurrentTab = 'list'">
        <i class="fas fa-server"></i> ‰∏ªÊú∫ÂàóË°®
      </button>
      <button class="tab-btn" :class="{ active: serverCurrentTab === 'history' }"
        @click="serverCurrentTab = 'history'; loadMetricsHistory()">
        <i class="fas fa-chart-line"></i> ÂéÜÂè≤ËÆ∞ÂΩï
      </button>
      <button class="tab-btn" :class="{ active: serverCurrentTab === 'management' }"
        @click="serverCurrentTab = 'management'">
        <i class="fas fa-cog"></i> ÂêéÂè∞ÁÆ°ÁêÜ
      </button>
      <button class="tab-btn" :class="{ active: serverCurrentTab === 'terminal' }"
        @click="serverCurrentTab = 'terminal'" @dblclick="closeAllSSHSessions" @auxclick.middle="closeAllSSHSessions"
        v-if="sshSessions.length > 0">
        <i class="fas fa-terminal"></i> SSH ÁªàÁ´Ø
      </button>

      <!-- SSH Âø´ÈÄüËøûÊé•‰∏ãÊãâÊåâÈíÆ -->
      <div class="ssh-quick-connect-wrapper" style="position: relative;">
        <button class="ssh-quick-connect-btn" @click="showSSHQuickMenu = !showSSHQuickMenu" title="Âø´ÈÄüËøûÊé•">
          <i class="fas fa-plus"></i>
        </button>

        <!-- ‰∏ãÊãâËèúÂçï -->
        <transition name="dropdown-fade">
          <div v-if="showSSHQuickMenu" class="ssh-quick-menu">
            <div class="ssh-quick-menu-header"
              style="display: flex; justify-content: space-between; align-items: center;">
              <span><i class="fas fa-terminal"></i> ÈÄâÊã©‰∏ªÊú∫</span>
              <button class="mini-btn-primary" @click="openAllServersInSSH(); showSSHQuickMenu = false"
                v-if="serverList.length > 0">
                <i class="fas fa-layer-group" style="margin-right: 4px;"></i> ÂÖ®ÈÉ®
              </button>
            </div>
            <div class="ssh-quick-menu-list">
              <div v-for="server in serverList" :key="'ssh-quick-list-' + server.id" @click="openSSHTerminal(server)"
                class="ssh-quick-item">
                <div :class="['server-status-indicator', server.status || 'unknown']"></div>
                <div class="ssh-quick-item-info">
                  <div class="ssh-quick-item-name">{{ server.name }}</div>
                  <div v-if="server.host && server.host !== '0.0.0.0'" class="ssh-quick-item-host">{{ server.host }}
                  </div>
                </div>
                <i class="fas fa-arrow-right"></i>
              </div>
              <div v-if="serverList.length === 0" class="ssh-quick-empty">
                <i class="fas fa-server"></i>
                ÊöÇÊó†‰∏ªÊú∫
              </div>
            </div>
          </div>
        </transition>
      </div>

    </div>
  </div>

  <!-- ÁÇπÂáªÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠‰∏ãÊãâËèúÂçï (Â∏¶Ê∑°ÂÖ•Ê∑°Âá∫) -->
  <transition name="fade">
    <div v-if="showSSHQuickMenu" @click="showSSHQuickMenu = false"
      style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 999;"></div>
  </transition>

  <!-- ‰∏ªÊú∫ÂàóË°®Ê†áÁ≠æÈ°µ -->
  <div v-show="serverCurrentTab === 'list'" class="sub-tab-content quick-fade-in">
    <!-- ÊûÅËá¥ÂçïË°åÂåñÂ∑•ÂÖ∑Êù° -->
    <div class="controls-bar"
      style="margin-bottom: 15px; padding: 10px 10px; border-bottom: 1px dashed var(--border-color); display: flex !important; flex-direction: row !important; align-items: center; justify-content: space-between; gap: 15px;">

      <!-- ÁªüËÆ°ËçØÁâáÁªÑ (Â∑¶‰æß) -->
      <div class="stats-pills" style="display: flex; gap: 8px; flex-shrink: 0;">
        <div class="stat-pill" :class="{ active: serverStatusFilter === 'all' }" @click="serverStatusFilter = 'all'"
          style="padding: 4px 12px; border-radius: 12px; font-size: 11px; cursor: pointer; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-secondary);">
          <span style="font-weight: 700;">ALL {{ serverList.length }}</span>
        </div>
        <div class="stat-pill online" :class="{ active: serverStatusFilter === 'online' }"
          @click="serverStatusFilter = 'online'"
          style="padding: 4px 12px; border-radius: 12px; font-size: 11px; cursor: pointer; border: 1px solid rgba(16, 185, 129, 0.2); background: rgba(16, 185, 129, 0.05); color: var(--success-color);">
          <i class="fas fa-check-circle" style="margin-right: 4px;"></i>
          <span style="font-weight: 700;">{{ serverList.filter(s => s.status === 'online').length }}</span>
        </div>
      </div>

      <!-- Âè≥‰æßÁªºÂêàÊìç‰ΩúÁªÑ (ÂåÖÂê´ÊêúÁ¥¢ÂíåÊåâÈíÆ) -->
      <div class="controls-right-group"
        style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; justify-content: flex-end;">
        <!-- ÊêúÁ¥¢Ê°Ü (ÂºπÊÄßÂÆΩÂ∫¶) -->
        <div class="search-box" style="position: relative; flex: 0 1 200px; min-width: 80px;">
          <i class="fas fa-search"
            style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: 0.4; font-size: 11px;"></i>
          <input v-model="serverSearchText" placeholder="ÊêúÁ¥¢..." class="form-input"
            style="padding-left: 28px; height: 30px; border-radius: 15px; background: var(--bg-secondary); border: 1px solid var(--border-color); width: 100%; font-size: 12px;" />
        </div>

        <button class="btn btn-primary btn-sm" @click="openAddServerModal" data-tooltip="Ê∑ªÂä†‰∏ªÊú∫"
          style="border-radius: 50%; width: 30px; height: 30px; padding: 0; min-width: 30px; flex-shrink: 0;">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <div v-if="serverLoading && serverList.length === 0" class="loading-overlay-elegant">
      <div class="ag-logo-pulse">
        <img src="./logo.svg" alt="Loading">
      </div>
      <p class="loading-text-elegant">Synchronizing Infrastructure</p>
    </div>

    <!-- ‰∏ªÊú∫Âç°ÁâáÂàóË°® -->
    <div v-for="server in filteredServerList" :key="server.id" class="server-card"
      :class="{ expanded: isServerExpanded(server.id) }"
      style="padding: 0; margin-bottom: 12px; border: 1px solid var(--border-color); background: var(--card-bg); transition: transform 0.2s, box-shadow 0.2s;">

      <!-- Card Header: Fully Responsive -->
      <div class="server-card-header" @click="toggleServer(server.id)"
        style="padding: 14px 16px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 12px; cursor: pointer;">

        <!-- Identity Group (Left) -->
        <div class="id-group" style="display: flex; align-items: center; gap: 15px; flex: 1; min-width: 180px;">
          <!-- Elegant Breathing Status Light -->
          <div class="status-indicator-modern" :class="server.status || 'unknown'"
            style="width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; position: relative;">
            <div class="status-glow" :class="{ 'ag-pulse': server.status === 'online' }" :style="{ 
              position: 'absolute', top: '-4px', left: '-4px', right: '-4px', bottom: '-4px', borderRadius: '50%',
              background: server.status === 'online' ? 'rgba(16, 185, 129, 0.4)' : 'rgba(239, 68, 68, 0.4)',
              boxShadow: server.status === 'online' ? '0 0 10px rgba(16, 185, 129, 0.5)' : 'none',
              animation: server.status === 'online' ? 'ag-pulse 2s ease-in-out infinite' : 'none'
            }"></div>
            <div :style="{ 
              position: 'absolute', top: '0', left: '0', width: '100%', height: '100%', borderRadius: '50%',
              background: server.status === 'online' ? '#10b981' : '#ef4444',
              zIndex: '2'
            }"></div>
          </div>

          <div style="display: flex; flex-direction: column; min-width: 0;">
            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
              <!-- OS Icon based on platform -->
              <i v-if="server.info && server.info.platform" :class="getOSIcon(server.info.platform)"
                :style="{ color: getOSColor(server.info.platform), fontSize: '14px', width: '16px', textAlign: 'center' }"
                :title="server.info.platform + ' ' + (server.info.platformVersion || '')"></i>
              <i v-else class="fas fa-server"
                style="color: var(--text-tertiary); font-size: 14px; width: 16px; text-align: center;" title="Êú™Áü•Á≥ªÁªü"></i>
              <span
                style="font-size: 15px; font-weight: 700; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{
                server.name }}</span>

              <!-- Tags (Moved to right of name) -->
              <div v-if="server.tags && server.tags.length > 0" style="display: flex; gap: 4px;">
                <span v-for="tag in server.tags" :key="tag"
                  style="font-size: 8px; padding: 1px 5px; border-radius: 4px; background: rgba(var(--primary-rgb), 0.1); color: var(--primary-color); border: 1px solid rgba(var(--primary-rgb), 0.2); font-weight: 600;">{{
                  tag }}</span>
              </div>

              <!-- Latency Pill Badge -->
              <div v-if="server.response_time" :style="{
                display: 'inline-flex',
                alignItems: 'center',
                padding: '1px 6px',
                borderRadius: '20px',
                fontSize: '9px',
                fontWeight: '800',
                fontFamily: 'var(--font-mono)',
                background: server.response_time < 100 ? 'rgba(16, 185, 129, 0.1)' : (server.response_time < 300 ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)'),
                color: server.response_time < 100 ? '#10b981' : (server.response_time < 300 ? '#f59e0b' : '#ef4444'),
                border: '1px solid ' + (server.response_time < 100 ? 'rgba(16, 185, 129, 0.2)' : (server.response_time < 300 ? 'rgba(245, 158, 11, 0.2)' : 'rgba(239, 68, 68, 0.2)'))
              }">
                {{ server.response_time }}ms
              </div>
            </div>
          </div>
        </div>

        <!-- Telemetry Group (Center/Responsive) -->
        <div class="network-metrics"
          style="display: flex; align-items: center; gap: 12px; flex: 2; justify-content: flex-end; min-width: 140px;">

          <!-- Network Speed Mini -->
          <div v-if="server.info && server.info.network" class="network-speed-mini"
            style="flex: 0 0 auto; display: flex; flex-direction: column; gap: 2px; align-items: flex-end;">
            <div
              style="display: flex; align-items: center; font-size: 10px; font-family: var(--font-mono); color: #3b82f6;">
              <span style="min-width: 30px; text-align: right;">{{ parseSpeed(server.info.network.tx_speed).num
                }}</span>
              <span style="width: 12px; text-align: center; opacity: 0.7;">{{
                parseSpeed(server.info.network.tx_speed).unit }}</span>
              <i class="fas fa-arrow-up" style="font-size: 7px; opacity: 0.6; margin-left: 2px;"></i>
            </div>
            <div
              style="display: flex; align-items: center; font-size: 10px; font-family: var(--font-mono); color: #10b981;">
              <span style="min-width: 30px; text-align: right;">{{ parseSpeed(server.info.network.rx_speed).num
                }}</span>
              <span style="width: 12px; text-align: center; opacity: 0.7;">{{
                parseSpeed(server.info.network.rx_speed).unit }}</span>
              <i class="fas fa-arrow-down" style="font-size: 7px; opacity: 0.6; margin-left: 2px;"></i>
            </div>
          </div>
        </div>

        <!-- Á°¨‰ª∂Ë¥üËΩΩÊåáÊ†áÁªÑ (CPU/MEM/DISK) -->
        <div class="metrics-meters" style="display: flex; align-items: center; gap: 12px; justify-content: flex-end;">
          <!-- CPU Micro-meter -->
          <div class="meter-item" style="flex: 1; min-width: 60px; max-width: 80px;">
            <div
              style="display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: var(--text-tertiary); margin-bottom: 4px; text-transform: uppercase;">
              <span>CPU</span>
              <span v-if="server.info && server.info.cpu" style="color: #10b981;">{{ parseInt(server.info.cpu.Usage)
                }}%</span>
            </div>
            <div style="height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden;">
              <div v-if="server.info && server.info.cpu" :style="{ 
                  width: server.info.cpu.Usage, height: '100%', 
                  transition: 'width 0.5s ease, background 0.3s ease',
                  background: parseFloat(server.info.cpu.Usage) > 85 ? '#ef4444' : '#10b981',
                  boxShadow: '0 0 4px ' + (parseFloat(server.info.cpu.Usage) > 85 ? 'rgba(239, 68, 68, 0.4)' : 'rgba(16, 185, 129, 0.2)')
                }"></div>
            </div>
          </div>

          <!-- MEM Micro-meter -->
          <div class="meter-item" style="flex: 1; min-width: 60px; max-width: 80px;">
            <div
              style="display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: var(--text-tertiary); margin-bottom: 4px; text-transform: uppercase;">
              <span>MEM</span>
              <span v-if="server.info && server.info.memory" style="color: #3b82f6;">{{
                parseInt(server.info.memory.Usage) }}%</span>
            </div>
            <div style="height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden;">
              <div v-if="server.info && server.info.memory" :style="{ 
                  width: server.info.memory.Usage, height: '100%', 
                  transition: 'width 0.5s ease, background 0.3s ease',
                  background: parseFloat(server.info.memory.Usage) > 85 ? '#ef4444' : '#3b82f6',
                  boxShadow: '0 0 4px ' + (parseFloat(server.info.memory.Usage) > 85 ? 'rgba(239, 68, 68, 0.4)' : 'rgba(59, 130, 246, 0.2)')
                }"></div>
            </div>
          </div>

          <!-- DISK Micro-meter -->
          <div class="meter-item" style="flex: 1; min-width: 60px; max-width: 80px;">
            <div
              style="display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: var(--text-tertiary); margin-bottom: 4px; text-transform: uppercase;">
              <span>DSK</span>
              <span v-if="server.info && server.info.disk && server.info.disk.length > 0" style="color: #a855f7;">{{
                parseInt(server.info.disk[0].usage) }}%</span>
            </div>
            <div style="height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden;">
              <div v-if="server.info && server.info.disk && server.info.disk.length > 0" :style="{ 
                  width: server.info.disk[0].usage, height: '100%', 
                  transition: 'width 0.5s ease, background 0.3s ease',
                  background: parseFloat(server.info.disk[0].usage) > 85 ? '#ef4444' : '#a855f7',
                  boxShadow: '0 0 4px ' + (parseFloat(server.info.disk[0].usage) > 85 ? 'rgba(239, 68, 68, 0.4)' : 'rgba(168, 85, 247, 0.2)')
                }"></div>
            </div>
          </div>

          <!-- GPU Micro-meter (only show when GPU Model exists) -->
          <div v-if="server.info && server.info.gpu && server.info.gpu.Model" class="meter-item"
            style="flex: 1; min-width: 60px; max-width: 80px;">
            <div
              style="display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: var(--text-tertiary); margin-bottom: 4px; text-transform: uppercase;">
              <span>GPU</span>
              <span style="color: #76b900;">{{ server.info.gpu.Usage || '0%' }}</span>
            </div>
            <div style="height: 4px; background: var(--bg-tertiary); border-radius: 2px; overflow: hidden;">
              <div :style="{ 
                  width: server.info.gpu.Usage || '0%', height: '100%', 
                  transition: 'width 0.5s ease, background 0.3s ease',
                  background: 'linear-gradient(90deg, #76b900, #8bc34a)',
                  boxShadow: '0 0 4px rgba(118, 185, 0, 0.3)'
                }"></div>
            </div>
          </div>
        </div>


        <!-- Action Group (Right) -->
        <div class="action-group" @click.stop style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;">
          <button class="btn-icon-refined" @click="openSSHTerminal(server)"
            style="width: 34px; height: 34px; background: var(--bg-tertiary);" title="SSH ÁªàÁ´Ø">
            <i class="fas fa-terminal" style="font-size: 13px;"></i>
          </button>
        </div>
      </div>

      <!-- Âç°ÁâáÂ±ïÂºÄËØ¶ÊÉÖÂå∫Âüü -->
      <div class="server-card-body">
        <div class="server-details">

          <div v-if="server.loading" class="skeleton-container">
            <div class="skeleton-grid">
              <!-- Á°¨‰ª∂ËΩΩËç∑È™®Êû∂ -->
              <div class="skeleton-section">
                <div class="skeleton-title">
                  <div class="skeleton-icon"></div>
                  <div class="skeleton-text title"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 120px;"></div>
                  <div class="skeleton-text value" style="width: 80px;"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 100px;"></div>
                  <div class="skeleton-text value" style="width: 60px;"></div>
                </div>
                <div class="skeleton-progress"></div>
                <div class="skeleton-row" style="margin-top: 12px;">
                  <div class="skeleton-text label" style="width: 140px;"></div>
                  <div class="skeleton-text value" style="width: 70px;"></div>
                </div>
                <div class="skeleton-progress"></div>
              </div>

              <!-- ÂõæË°®È™®Êû∂ -->
              <div class="skeleton-section" style="min-width: 280px;">
                <div class="skeleton-title">
                  <div class="skeleton-icon"></div>
                  <div class="skeleton-text title"></div>
                </div>
                <div class="skeleton-chart"></div>
              </div>

              <!-- Â≠òÂÇ®ËµÑÊ∫êÈ™®Êû∂ -->
              <div class="skeleton-section">
                <div class="skeleton-title">
                  <div class="skeleton-icon"></div>
                  <div class="skeleton-text title"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 100px;"></div>
                  <div class="skeleton-text value" style="width: 90px;"></div>
                </div>
                <div class="skeleton-progress"></div>
              </div>

              <!-- ÁΩëÁªúËµÑÊ∫êÈ™®Êû∂ -->
              <div class="skeleton-section">
                <div class="skeleton-title">
                  <div class="skeleton-icon"></div>
                  <div class="skeleton-text title"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 70px;"></div>
                  <div class="skeleton-text value" style="width: 50px;"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 80px;"></div>
                  <div class="skeleton-text value" style="width: 70px;"></div>
                </div>
                <div class="skeleton-row">
                  <div class="skeleton-text label" style="width: 80px;"></div>
                  <div class="skeleton-text value" style="width: 70px;"></div>
                </div>
              </div>
            </div>
          </div>

          <div v-else-if="server.error" class="error" style="margin: 0px 3px;">
            <i class="fas fa-exclamation-circle"></i> {{ server.error }}
          </div>

          <div v-else-if="server.info">
            <!-- ‰∏ªË¶Å‰ø°ÊÅØÁΩëÊ†º -->
            <div class="server-details-grid">
              <!-- Á≥ªÁªü‰ø°ÊÅØ -->
              <div class="server-detail-section">
                <h4>
                  <i class="fas fa-microchip"></i> Á°¨‰ª∂ËΩΩËç∑
                  <span v-if="server.info.platformShort"
                    style="font-size: 11px; font-weight: 400; opacity: 0.7; margin-left: 8px;">{{
                    server.info.platformShort }}</span>
                </h4>
                <div v-if="server.info.cpu && server.info.cpu.Load" class="server-detail-item"
                  style="border:none; padding-bottom: 4px;">
                  <span class="server-detail-label">Á≥ªÁªüË¥üËΩΩ (1/5/15min)</span>
                  <span class="server-detail-value">{{ server.info.cpu.Load }}</span>
                </div>
                <div v-if="server.info.cpu" class="server-detail-item">
                  <span class="server-detail-label">CPU Ë¥üËΩΩ ({{ server.info.cpu.Cores || '-' }} Ê†∏ÂøÉ)</span>
                  <span class="server-detail-value">{{ server.info.cpu.Usage || '-' }}</span>
                </div>
                <div v-if="server.info.cpu" class="progress-bar">
                  <div class="progress-bar-fill" :style="{ width: server.info.cpu.Usage || '0%' }"></div>
                </div>

                <div v-if="server.info.memory" class="server-detail-item" style="margin-top: 12px;">
                  <span class="server-detail-label">ÂÜÖÂ≠ò‰ΩøÁî® ({{ server.info.memory.Used || '-' }} / {{
                    server.info.memory.Total || '-' }})</span>
                  <span class="server-detail-value">{{ server.info.memory.Usage || '-' }}</span>
                </div>
                <div v-if="server.info.memory" class="progress-bar">
                  <div class="progress-bar-fill" :class="getMemoryClass(server.info.memory.Usage)"
                    :style="{ width: server.info.memory.Usage || '0%' }"></div>
                </div>
              </div>

              <!-- ÁõëÊéßÂõæË°® -->
              <div class="server-detail-section" style="min-width: 280px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                  <h4 style="margin-bottom: 0;"><i class="fas fa-chart-line"></i> Ë¥üËΩΩË∂ãÂäø</h4>
                  <div style="display: flex; gap: 8px;">
                    <span style="font-size: 10px; color: #10b981; display: flex; align-items: center; gap: 4px;">
                      <span style="width: 6px; height: 6px; border-radius: 50%; background: #10b981;"></span> CPU
                    </span>
                    <span style="font-size: 10px; color: #3b82f6; display: flex; align-items: center; gap: 4px;">
                      <span style="width: 6px; height: 6px; border-radius: 50%; background: #3b82f6;"></span> Mem
                    </span>
                    <span v-if="server.info.gpu !== undefined && server.info.gpu !== null"
                      style="font-size: 10px; color: #76b900; display: flex; align-items: center; gap: 4px;">
                      <span style="width: 6px; height: 6px; border-radius: 50%; background: #76b900;"></span> GPU
                    </span>
                  </div>
                </div>
                <div style="height: 145px; position: relative; border-radius: 12px">
                  <canvas :id="'metrics-chart-card-' + server.id"></canvas>
                  <!-- Êó†Êï∞ÊçÆÁä∂ÊÄÅÊèêÁ§∫ -->
                  <div v-if="!server.info || server.loading"
                    style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-tertiary); gap: 8px; background: var(--bg-tertiary); border-radius: 12px;">
                    <div class="ag-spinner-elegant ag-spinner-elegant-sm"></div>
                    <span style="font-size: 10px; opacity: 0.6; letter-spacing: 1px;">LOADING METRICS</span>
                  </div>
                </div>
              </div>

              <!-- ËÆ°ÁÆó‰∏éÂ≠òÂÇ® (ÁøªËΩ¨Âç°Áâá) -->
              <!-- ËÆ°ÁÆó‰∏éÂ≠òÂÇ® (ÁøªËΩ¨Âç°Áâá) -->
              <div class="flip-card" :class="{ 'flipped': server.gpuChartVisible }" @click="toggleGpuChart(server)"
                style="height: 100%; min-height: 190px; perspective: 1000px; cursor: pointer; margin-bottom: 0;"
                title="ÁÇπÂáªÁøªËΩ¨Êü•Áúã GPU Ë∂ãÂäø">
                <div class="flip-card-inner"
                  style="position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d;">
                  <!-- Ê≠£Èù¢: ‰ø°ÊÅØ -->
                  <div class="flip-card-front server-detail-section"
                    style="position: absolute; inset: 0; backface-visibility: hidden; display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden;">
                    <h4>
                      <i class="fas fa-microchip"></i> ËÆ°ÁÆó‰∏éÂ≠òÂÇ®
                      <i class="fas fa-sync-alt" style="font-size: 10px; margin-left: 6px; opacity: 0.5;"></i>
                    </h4>

                    <!-- GPU ‰ø°ÊÅØ -->
                    <!-- GPU ‰ø°ÊÅØÔºöÂêåÊó∂Ê£ÄÊü•ÂÆûÊó∂Êï∞ÊçÆÂíåÂéÜÂè≤ÁºìÂ≠ò -->
                    <div
                      v-if="(server.info.gpu && (server.info.gpu.Model || server.info.gpu.Usage)) || (server.metricsCache && server.metricsCache.some(r => r.gpu_usage !== null && r.gpu_usage !== undefined && r.gpu_usage > 0))">
                      <div class="server-detail-item">
                        <span class="server-detail-label">
                          <i class="fas fa-gamepad" style="margin-right: 4px; color: #76b900;"></i>
                          {{ server.info.gpu && server.info.gpu.Model ? server.info.gpu.Model : 'GPU' }}
                        </span>
                        <span class="server-detail-value">{{ server.info.gpu && server.info.gpu.Usage ?
                          server.info.gpu.Usage : '0%' }}</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-bar-fill" style="background: linear-gradient(90deg, #76b900, #8bc34a);"
                          :style="{ width: (server.info.gpu && server.info.gpu.Usage) || '0%' }"></div>
                      </div>
                      <div v-if="server.info.gpu && server.info.gpu.Memory" class="server-detail-item"
                        style="border:none; padding: 4px 0 0 0;">
                        <span class="server-detail-label" style="font-size: 11px; opacity: 0.7;">ÊòæÂ≠ò / ÂäüËÄó</span>
                        <span class="server-detail-value" style="font-size: 11px; opacity: 0.7;">{{
                          server.info.gpu.Memory }} / {{ server.info.gpu.Power || '0W' }}</span>
                      </div>
                    </div>
                    <div v-else class="server-detail-item" style="border: none; opacity: 0.5;">
                      <span class="server-detail-label"><i class="fas fa-gamepad" style="margin-right: 4px;"></i>
                        GPU</span>
                      <span class="server-detail-value">Êú™Ê£ÄÊµãÂà∞</span>
                    </div>

                    <!-- ÂºπÊÄßÂç†‰Ωç -->
                    <div style="flex: 1;"></div>

                    <!-- Á£ÅÁõòÂ≠òÂÇ® (Â∫ïÈÉ®) -->
                    <div v-if="server.info.disk && server.info.disk.length > 0"
                      style="margin-top: auto; padding-top: 12px;">
                      <div class="server-detail-item" style="border: none; padding-bottom: 4px;">
                        <span class="server-detail-label">
                          <i class="fas fa-hdd" style="margin-right: 4px;"></i>
                          ‰∏ªÂ≠òÂÇ® ({{ server.info.disk[0].usage }})
                        </span>
                        <span class="server-detail-value" style="font-size: 11px; opacity: 0.8;">{{
                          server.info.disk[0].used }} / {{ server.info.disk[0].total }}</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-bar-fill" :class="getDiskClass(server.info.disk[0].usage)"
                          :style="{ width: server.info.disk[0].usage }"></div>
                      </div>
                    </div>
                  </div>

                  <!-- ËÉåÈù¢: GPU ÂõæË°® -->
                  <div class="flip-card-back server-detail-section"
                    style="position: absolute; inset: 0; backface-visibility: hidden; transform: rotateX(180deg); display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden;">
                    <h4 title="ÁÇπÂáªËøîÂõû">
                      <i class="fas fa-chart-area" style="color: #76b900;"></i> GPU Ë∂ãÂäø
                      <i class="fas fa-undo" style="font-size: 10px; margin-left: 6px; opacity: 0.5;"></i>
                    </h4>
                    <div style="height: 165px; position: relative; margin-top: 4px;">
                      <canvas :id="'gpu-chart-' + server.id"></canvas>
                      <div v-if="server.gpuLoading"
                        style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-tertiary); gap: 8px; background: var(--bg-tertiary); border-radius: 8px;">
                        <div class="ag-spinner-elegant ag-spinner-elegant-sm"></div>
                        <span style="font-size: 10px; opacity: 0.6;">LOADING GPU METRICS</span>
                      </div>
                      <!-- Êó†Êï∞ÊçÆÁä∂ÊÄÅÊèêÁ§∫ÔºöÂêåÊó∂Ê£ÄÊü•ÂÆûÊó∂GPUÂûãÂè∑ÂíåÂéÜÂè≤ÁºìÂ≠ò‰∏≠ÁöÑGPUÊï∞ÊçÆ -->
                      <div
                        v-if="!server.gpuLoading && (!server.info.gpu || !server.info.gpu.Model) && (!server.metricsCache || !server.metricsCache.some(r => r.gpu_usage !== null && r.gpu_usage !== undefined))"
                        style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: var(--text-tertiary); background: rgba(0,0,0,0.05); border-radius: 8px;">
                        <span>Êó† GPU ÈááÈõÜÊï∞ÊçÆ</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ÁΩëÁªúËµÑÊ∫ê -->
              <div class="server-detail-section">
                <h4><i class="fas fa-network-wired"></i> ÁΩëÁªúÈÄüÁéá</h4>
                <div v-if="server.info.network">
                  <div class="server-detail-item">
                    <span class="server-detail-label">Ê¥ªË∑ÉËøûÊé•Êï∞</span>
                    <span class="server-detail-value"
                      style="font-family: var(--font-mono); font-weight: 700; color: var(--paas-primary);">{{
                      server.info.network.connections || 0 }}</span>
                  </div>
                  <div class="server-detail-item" style="padding: 6px 0;">
                    <span class="server-detail-label">
                      <i class="fas fa-arrow-down" style="color: #10b981; font-size: 10px;"></i> ‰∏ãËΩΩÈÄüÂ∫¶
                    </span>
                    <span class="server-detail-value"
                      style="color: #10b981; font-weight: 700; font-family: var(--font-mono);">
                      {{ server.info.network.rx_speed }}
                    </span>
                  </div>
                  <div class="server-detail-item" style="padding: 6px 0;">
                    <span class="server-detail-label">
                      <i class="fas fa-arrow-up" style="color: #3b82f6; font-size: 10px;"></i> ‰∏ä‰º†ÈÄüÂ∫¶
                    </span>
                    <span class="server-detail-value"
                      style="color: #3b82f6; font-weight: 700; font-family: var(--font-mono);">
                      {{ server.info.network.tx_speed }}
                    </span>
                  </div>
                  <div class="server-detail-item"
                    style="border:none; padding: 4px 0 0 0; opacity: 0.8; font-size: 11px;">
                    <span class="server-detail-label">Á¥ØËÆ°ÊµÅÈáè (RX/TX)</span>
                    <span class="server-detail-value">{{ server.info.network.rx_total }} / {{
                      server.info.network.tx_total }}</span>
                  </div>
                </div>
              </div>

              <!-- ÂÆπÂô®ËôöÊãüÂåñ - ÂèØÊäòÂè†Èù¢Êùø (‰ªÖÂú®Ê£ÄÊµãÂà∞ Docker Êó∂ÊòæÁ§∫) -->
              <div v-if="server.info && server.info.docker && server.info.docker.installed"
                class="server-detail-section docker-section" style="grid-column: 1 / -1;">
                <div class="docker-section-header" @click.stop="toggleDockerPanel(server.id)" style="cursor: pointer;">
                  <h4>
                    <i class="fab fa-docker"></i> ÂÆπÂô®ËôöÊãüÂåñ
                  </h4>
                  <div class="docker-section-status">
                    <span class="docker-status-badge"
                      :class="server.info.docker.installed ? 'installed' : 'not-installed'">
                      {{ server.info.docker.installed ? 'Â∑≤ÂÆâË£Ö' : 'Êú™Ê£ÄÊµãÂà∞' }}
                    </span>
                    <span
                      v-if="server.info.docker.installed && ((server.info.docker.containers && server.info.docker.containers.length > 0) || server.info.docker.runningCount !== undefined)"
                      class="docker-container-count">
                      <span style="color: var(--success-color);">‚óè </span>
                      {{ (server.info.docker.containers && server.info.docker.containers.length > 0) ?
                      getRunningContainers(server.info.docker.containers)
                      : (server.info.docker.runningCount || 0) }} ËøêË°å

                      <!-- ÊöÇÂÅúÊï∞Èáè (‰ªÖÂú®Âä†ËΩΩ‰∫ÜËØ¶ÊÉÖÂêéÊòæÁ§∫Á≤æÁ°ÆÊï∞) -->
                      <span
                        v-if="server.info.docker.containers && server.info.docker.containers.length > 0 && getPausedContainers(server.info.docker.containers) > 0"
                        style="margin-left: 8px; color: var(--warning-color);">‚óè </span>
                      <span
                        v-if="server.info.docker.containers && server.info.docker.containers.length > 0 && getPausedContainers(server.info.docker.containers) > 0">
                        {{ getPausedContainers(server.info.docker.containers) }} ÊöÇÂÅú
                      </span>

                      <!-- ÂÅúÊ≠¢Êï∞Èáè (ÂÆûÊó∂ÊµÅÊîØÊåÅ) -->
                      <span
                        v-if="(server.info.docker.containers && server.info.docker.containers.length > 0) ? getStoppedContainers(server.info.docker.containers) > 0 : (server.info.docker.stoppedCount > 0)"
                        style="margin-left: 8px; color: var(--danger-color);">‚óè </span>
                      <span
                        v-if="(server.info.docker.containers && server.info.docker.containers.length > 0) ? getStoppedContainers(server.info.docker.containers) > 0 : (server.info.docker.stoppedCount > 0)">
                        {{ (server.info.docker.containers && server.info.docker.containers.length > 0) ?
                        getStoppedContainers(server.info.docker.containers) : server.info.docker.stoppedCount }} ÂÅúÊ≠¢
                      </span>
                    </span>
                  </div>
                </div>

                <!-- Â±ïÂºÄÁöÑÂÆπÂô®Èù¢Êùø - ‰ΩøÁî®Á±ª‰ºº modal ÁöÑÊ†∑Âºè -->
                <div v-if="isDockerPanelExpanded(server.id) && server.info.docker.installed"
                  class="docker-panel-content">
                  <div v-if="server.info.docker.containers && server.info.docker.containers.length > 0"
                    class="docker-containers-grid">
                    <div v-for="container in server.info.docker.containers" :key="container.id"
                      class="docker-container-mini-card" :class="{ 
                              'running': container.state === 'running' || (container.status && container.status.includes('Up') && !container.status.includes('Paused')),
                              'paused': container.state === 'paused' || (container.status && container.status.includes('Paused'))
                            }">
                      <div class="container-info">
                        <span class="container-status-dot"
                          :class="{ 'online': container.state === 'running' || (container.status && container.status.includes('Up') && !container.status.includes('Paused')), 'paused': container.state === 'paused' || (container.status && container.status.includes('Paused')) }"></span>
                        <span class="container-name" :title="container.name">{{ container.name }}</span>
                      </div>
                      <div class="container-actions">
                        <button
                          v-if="container.state === 'running' || (container.status && container.status.includes('Up') && !container.status.includes('Paused'))"
                          class="btn btn-xs btn-warning icon-only"
                          @click.stop="handleDockerAction(server.id, container.id, 'pause')" title="ÊöÇÂÅú">
                          <i class="fas fa-pause"></i>
                        </button>
                        <button
                          v-else-if="container.state === 'paused' || (container.status && container.status.includes('Paused'))"
                          class="btn btn-xs btn-success icon-only"
                          @click.stop="handleDockerAction(server.id, container.id, 'unpause')" title="ÊÅ¢Â§ç">
                          <i class="fas fa-play"></i>
                        </button>
                        <button v-else class="btn btn-xs btn-success icon-only"
                          @click.stop="handleDockerAction(server.id, container.id, 'start')" title="ÂêØÂä®">
                          <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-xs btn-secondary icon-only"
                          @click.stop="handleDockerAction(server.id, container.id, 'restart')" title="ÈáçÂêØ">
                          <i class="fas fa-redo-alt"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div v-else class="docker-empty-mini">
                    <i class="fab fa-docker"></i>
                    <span>ÊöÇÊó†ÂÆπÂô®</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div v-if="!serverLoading && filteredServerList.length === 0" class="empty-state">
      <div class="server-empty-state-icon">üîç</div>
      <p>Êú™ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑ‰∏ªÊú∫</p>
    </div>
  </div>

  <!-- ÂéÜÂè≤ËÆ∞ÂΩïÊ†áÁ≠æÈ°µ -->
  <div v-show="serverCurrentTab === 'history'" class="sub-tab-content quick-fade-in">
    <!-- ÂõæË°®Â±ïÁ§∫Âå∫ (ÂèØÊäòÂè†ÔºåÈªòËÆ§Êî∂Ëµ∑) -->
    <div class="panel" style="margin-bottom: 16px;" v-if="Object.keys(groupedMetricsHistory).length > 0">
      <div class="panel-header" @click="showMetricsCharts = !showMetricsCharts"
        style="margin-bottom: 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; cursor: pointer; user-select: none;">
        <div class="panel-title" style="display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-chart-area" style="color: var(--server-primary);"></i>
          <span>Ë¥üËΩΩË∂ãÂäøÊ¶ÇËßà</span>
          <span style="font-size: 11px; color: var(--text-tertiary); font-weight: 400;">
            ({{ Object.keys(groupedMetricsHistory).length }} Âè∞‰∏ªÊú∫)
          </span>
          <i class="fas" :class="showMetricsCharts ? 'fa-chevron-up' : 'fa-chevron-down'"
            style="font-size: 12px; color: var(--text-tertiary); margin-left: 4px;"></i>
        </div>

        <!-- Êó∂Èó¥ÈÄâÊã©Ôºà‰ªÖÂú®Â±ïÂºÄÊó∂ÊòæÁ§∫Ôºâ -->
        <div v-show="showMetricsCharts" class="metrics-history-toolbar" @click.stop
          style="border: none; padding: 0; margin: 0; background: transparent;">
          <div class="time-range-pills">
            <button class="pill-btn" :class="{ active: metricsHistoryTimeRange === '1h' }"
              @click="setMetricsTimeRange('1h')">1h</button>
            <button class="pill-btn" :class="{ active: metricsHistoryTimeRange === '6h' }"
              @click="setMetricsTimeRange('6h')">6h</button>
            <button class="pill-btn" :class="{ active: metricsHistoryTimeRange === '24h' }"
              @click="setMetricsTimeRange('24h')">24h</button>
            <button class="pill-btn" :class="{ active: metricsHistoryTimeRange === '7d' }"
              @click="setMetricsTimeRange('7d')">7d</button>
            <button class="pill-btn" :class="{ active: metricsHistoryTimeRange === 'all' }"
              @click="setMetricsTimeRange('all')">ÂÖ®ÈÉ®</button>
          </div>

          <button class="metrics-toolbar-btn" @click="loadMetricsHistory()" :disabled="metricsHistoryLoading"
            title="Âà∑Êñ∞Êï∞ÊçÆ">
            <i class="fas fa-sync-alt" :class="{ 'fa-spin': metricsHistoryLoading }"></i>
          </button>
        </div>
      </div>

      <!-- ÂõæË°®ÁΩëÊ†ºÔºàÂ±ïÂºÄÊó∂ÊâçÊ∏≤ÊüìÔºâ -->
      <div v-show="showMetricsCharts" class="metrics-charts-grid" style="margin-top: 15px;
        display: grid; grid-template-columns: repeat(auto-fit, minmax(min(400px, 100%), 1fr)); gap: 8px;">
        <div v-for="(records, serverId) in groupedMetricsHistory" :key="'chart-' + serverId" class="metrics-chart-card"
          style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 15px; min-height: 250px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <div style="font-weight: 700; font-size: 13px;">{{ records[0]?.server_name }}</div>
            <div style="display: flex; gap: 8px;">
              <span style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: #10b981;">
                <span style="width: 8px; height: 8px; border-radius: 2px; background: #10b981;"></span> CPU
              </span>
              <span style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: #3b82f6;">
                <span style="width: 8px; height: 8px; border-radius: 2px; background: #3b82f6;"></span> Mem
              </span>
              <span v-if="records.some(r => r.gpu_usage !== null)"
                style="font-size: 12px; display: flex; align-items: center; gap: 4px; color: #76b900;">
                <span style="width: 8px; height: 8px; border-radius: 2px; background: #76b900;"></span> GPU
              </span>
            </div>
          </div>
          <div style="height: 190px; position: relative;">
            <canvas :id="'metrics-chart-' + serverId"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"
        style="border-bottom: 1px solid var(--border-color); padding-bottom: 12px; margin-bottom: 16px;">
        <div
          style="display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; gap: 12px;">
          <div class="panel-title-group" style="display: flex; align-items: center; gap: 12px;">
            <div class="panel-title">
              <i class="fas fa-chart-line" style="margin-right: 8px; color: var(--server-primary);"></i>ÂéÜÂè≤ÊåáÊ†áËÆ∞ÂΩï
            </div>
            <span v-if="metricsHistoryTotal > 0" class="badge"
              style="background: var(--bg-tertiary); color: var(--text-secondary); padding: 4px 10px; border-radius: 12px; font-size: 11px;">
              ÂÖ± {{ metricsHistoryTotal }} Êù°ËÆ∞ÂΩï
            </span>
          </div>

          <div class="metrics-history-toolbar">
            <!-- ‰∏ªÊú∫Á≠õÈÄâ (‰øùÁïô) -->
            <div class="metrics-filter-select">
              <i class="fas fa-server"></i>
              <select v-model="metricsHistoryFilter.serverId" @change="loadMetricsHistory(1)">
                <option value="">ÂÖ®ÈÉ®‰∏ªÊú∫</option>
                <option v-for="server in serverList" :key="server.id" :value="server.id">{{ server.name }}</option>
              </select>
              <i class="fas fa-chevron-down"></i>
            </div>

            <!-- ÊâãÂä®ÈááÈõÜÊåâÈíÆ (‰øùÁïô) -->
            <button class="metrics-toolbar-btn primary" @click="triggerMetricsCollect" title="Á´ãÂç≥ÈááÈõÜ‰∏ÄÊ¨°ÂΩìÂâçÊåáÊ†á">
              <i class="fas fa-camera"></i>
              <span>ÈááÈõÜ</span>
            </button>

            <!-- Ê∏ÖÈô§Êï∞ÊçÆÊåâÈíÆ -->
            <button class="metrics-toolbar-btn danger" @click="clearMetricsHistory" title="Ê∏ÖÈô§ÊâÄÊúâÂéÜÂè≤ÊåáÊ†áÊï∞ÊçÆ">
              <i class="fas fa-trash-alt"></i>
              <span>Ê∏ÖÈô§</span>
            </button>
          </div>
        </div>
      </div>

      <!-- ÈááÈõÜÂô®Áä∂ÊÄÅÊèêÁ§∫ -->
      <!-- ÈááÈõÜÂô®Áä∂ÊÄÅÊèêÁ§∫ (ÁæéÂåñÁâà) -->
      <div v-if="metricsCollectorStatus" class="collector-status-bar"
        style="display: flex; flex-wrap: wrap; align-items: center; gap: 12px; margin-bottom: 16px;">

        <!-- Áä∂ÊÄÅËÉ∂Âõä -->
        <div :class="metricsCollectorStatus.isRunning ? 'status-pill-running' : 'status-pill-stopped'"
          style="display: flex; align-items: center; gap: 8px; padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid;">
          <span :class="metricsCollectorStatus.isRunning ? 'status-dot online' : 'status-dot offline'"
            style="box-shadow: none;"></span>
          <span>{{ metricsCollectorStatus.isRunning ? 'ÈááÈõÜÊúçÂä°ËøêË°å‰∏≠' : 'ÈááÈõÜÊúçÂä°Â∑≤ÂÅúÊ≠¢' }}</span>
        </div>

        <!-- ‰ø°ÊÅØËÉ∂ÂõäÁªÑ -->
        <div style="display: flex; gap: 8px;">
          <div
            style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            <i class="fas fa-clock" style="color: var(--server-primary);"></i>
            <span>ÈááÈõÜÈó¥Èöî <span style="font-weight: 700; color: var(--text-primary);">{{
                Math.floor(metricsCollectorStatus.interval / 60000) }}m</span></span>
          </div>
          <div
            style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            <i class="fas fa-database" style="color: #a855f7;"></i>
            <span>Â∑≤ÁºìÂ≠ò <span style="font-weight: 700; color: var(--text-primary);">{{
                metricsCollectorStatus.cachedServers }}</span></span>
          </div>
          <div
            style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            <i class="fas fa-stream" style="color: #3b82f6;"></i>
            <span>Ê¥ªË∑ÉÊµÅ <span style="font-weight: 700; color: var(--text-primary);">{{
                metricsCollectorStatus.activeStreams }}</span></span>
          </div>
        </div>
      </div>

      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
      <div v-if="metricsHistoryLoading" class="loading-overlay-elegant">
        <div class="ag-logo-pulse">
          <img src="./logo.svg" alt="Loading">
        </div>
        <div class="loading-text-elegant">Fetching Historical Metrics</div>
      </div>

      <!-- Êåâ‰∏ªÊú∫ÂàÜÁ±ªÁöÑÂéÜÂè≤ËÆ∞ÂΩï -->
      <div v-else class="metrics-history-grouped">
        <!-- Êåâ‰∏ªÊú∫ÂàÜÁªÑÊòæÁ§∫ -->
        <div v-for="(records, serverId) in groupedMetricsHistory" :key="serverId" class="metrics-server-card">
          <div class="metrics-server-header" @click="toggleMetricsServerExpand(serverId)">
            <div class="metrics-server-info">
              <!-- OS Icon -->
              <i v-if="records[0]?.platform" :class="getOSIcon(records[0].platform)"
                :style="{ color: getOSColor(records[0].platform), fontSize: '14px', width: '16px', textAlign: 'center' }"></i>
              <i v-else class="fas fa-server"></i>
              <span class="metrics-server-name">{{ records[0]?.server_name || 'Êú™Áü•‰∏ªÊú∫' }}</span>
              <code v-if="records[0]?.server_host && records[0].server_host !== '0.0.0.0'"
                class="metrics-server-host">{{ formatHost(records[0]?.server_host) }}</code>
            </div>
            <div class="metrics-server-stats">
              <span class="metrics-record-count">{{ records.length }} Êù°ËÆ∞ÂΩï</span>
              <i class="fas"
                :class="expandedMetricsServers.includes(serverId) ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
            </div>
          </div>

          <!-- Â±ïÂºÄÁöÑËÆ∞ÂΩïÂàóË°® -->
          <div v-show="expandedMetricsServers.includes(serverId)" class="metrics-records-list">
            <div v-for="record in records" :key="record.id" class="metrics-record-item">
              <div class="metrics-record-time">
                <i class="far fa-clock"></i>
                {{ formatDateTime(record.recorded_at) }}
              </div>
              <div class="metrics-record-data">
                <div class="metrics-data-item">
                  <span class="metrics-data-label">CPU</span>
                  <span class="metrics-data-value" :class="getCpuClass(record.cpu_usage)">
                    {{ record.cpu_usage?.toFixed(1) || '-' }}%
                  </span>
                </div>
                <div class="metrics-data-item">
                  <span class="metrics-data-label">ÂÜÖÂ≠ò</span>
                  <span class="metrics-data-value" :class="getMemoryClass(record.mem_usage + '%')">
                    {{ record.mem_usage?.toFixed(1) || '-' }}%
                  </span>
                </div>
                <div class="metrics-data-item">
                  <span class="metrics-data-label">Á£ÅÁõò</span>
                  <span class="metrics-data-value" :class="getDiskClass(record.disk_usage + '%')">
                    {{ record.disk_usage?.toFixed(1) || '-' }}%
                  </span>
                </div>
                <div class="metrics-data-item" v-if="record.docker_installed">
                  <span class="metrics-data-label">Docker</span>
                  <span class="metrics-data-value">
                    {{ record.docker_running || 0 }}/{{ record.docker_stopped || 0 }}
                  </span>
                </div>
                <!-- GPU ÂéÜÂè≤Êï∞ÊçÆ -->
                <div class="metrics-data-item" v-if="record.gpu_usage !== null && record.gpu_usage !== undefined">
                  <span class="metrics-data-label">GPU</span>
                  <span class="metrics-data-value" style="color: #76b900;">
                    {{ record.gpu_usage?.toFixed(1) }}% / {{ record.gpu_power }}W
                  </span>
                </div>
                <div class="metrics-data-item" v-if="record.gpu_mem_total > 0">
                  <span class="metrics-data-label">ÊòæÂ≠ò</span>
                  <span class="metrics-data-value" style="color: #8bc34a;">
                    {{ ((record.gpu_mem_used / record.gpu_mem_total) * 100).toFixed(1) }}%
                  </span>
                </div>
                <div class="metrics-data-item">
                  <span class="metrics-data-label">Ë¥üËΩΩ</span>
                  <code class="metrics-load-value">{{ record.cpu_load || '-' }}</code>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div v-if="Object.keys(groupedMetricsHistory).length === 0" class="empty-state">
          <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
          <div>ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>
          <p style="color: var(--text-tertiary); font-size: 12px; margin-top: 8px;">Á≥ªÁªüÊØè 5 ÂàÜÈíüËá™Âä®ÈááÈõÜ‰∏ÄÊ¨°ÊåáÊ†áÊï∞ÊçÆ</p>
        </div>

        <!-- ÂàÜÈ°µ -->

      </div>
    </div>
  </div>

  <!-- ÂêéÂè∞ÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
  <div v-show="serverCurrentTab === 'management'" class="sub-tab-content quick-fade-in">
    <!-- ‰∏ªÊú∫ÁÆ°ÁêÜÈù¢Êùø -->
    <div class="panel">
      <div class="panel-header"
        style="border-bottom: 1px solid var(--border-color); padding-bottom: 12px; margin-bottom: 12px;">
        <div
          style="display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; gap: 12px;">
          <div class="panel-title-group" style="display: flex; align-items: center; gap: 12px;">
            <div class="panel-title"><i class="fas fa-server"
                style="margin-right: 8px; color: var(--server-primary);"></i>‰∏ªÊú∫ÂÆû‰æãÁÆ°ÁêÜ</div>

            <!-- Âø´ÈÄüÂàáÊç¢ÊòæÁ§∫Ê®°Âºè -->
            <div class="display-mode-chips"
              style="display: flex; background: var(--bg-secondary); padding: 2px; border-radius: 8px; border: 1px solid var(--border-color); margin-left: 8px;">
              <button class="chip-btn" :class="{ active: serverIpDisplayMode === 'normal' }"
                @click="serverIpDisplayMode = 'normal'"
                style="padding: 2px 8px; font-size: 12px; border-radius: 6px; border: none; cursor: pointer; transition: all 0.2s;"
                :style="{ background: serverIpDisplayMode === 'normal' ? 'var(--server-primary)' : 'transparent', color: serverIpDisplayMode === 'normal' ? 'white' : 'var(--text-tertiary)' }">
                ÊòéÊñá
              </button>
              <button class="chip-btn" :class="{ active: serverIpDisplayMode === 'masked' }"
                @click="serverIpDisplayMode = 'masked'"
                style="padding: 2px 8px; font-size: 12px; border-radius: 6px; border: none; cursor: pointer; transition: all 0.2s;"
                :style="{ background: serverIpDisplayMode === 'masked' ? 'var(--server-primary)' : 'transparent', color: serverIpDisplayMode === 'masked' ? 'white' : 'var(--text-tertiary)' }">
                ÊâìÁ†Å
              </button>
              <button class="chip-btn" :class="{ active: serverIpDisplayMode === 'hidden' }"
                @click="serverIpDisplayMode = 'hidden'"
                style="padding: 2px 8px; font-size: 12px; border-radius: 6px; border: none; cursor: pointer; transition: all 0.2s;"
                :style="{ background: serverIpDisplayMode === 'hidden' ? 'var(--server-primary)' : 'transparent', color: serverIpDisplayMode === 'hidden' ? 'white' : 'var(--text-tertiary)' }">
                ÈöêËóè
              </button>
            </div>
          </div>

          <div class="server-management-actions" style="display: flex; gap: 8px;">
            <button class="btn btn-success btn-sm" @click="openAddServerModal" title="Ê∑ªÂä†‰∏ªÊú∫">
              <i class="fas fa-plus"></i> <span>Ê∑ªÂä†‰∏ªÊú∫</span>
            </button>
            <button class="btn btn-primary btn-sm" @click="showBatchAgentInstallModal" title="ÊâπÈáèÈÉ®ÁΩ≤ Agent">
              <i class="fas fa-robot"></i> <span>ÊâπÈáèÈÉ®ÁΩ≤ Agent</span>
            </button>
            <button class="btn btn-secondary btn-sm" @click="loadServerList" :disabled="serverLoading" title="Âà∑Êñ∞ÂàóË°®">
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': serverLoading }"></i>
            </button>
            <button class="btn btn-secondary btn-sm" @click="exportServers" title="ÂØºÂá∫">
              <i class="fas fa-upload"></i> <span>ÂØºÂá∫</span>
            </button>
            <button class="btn btn-secondary btn-sm" @click="openImportServerModal" title="ÂØºÂÖ•">
              <i class="fas fa-download"></i> <span>ÂØºÂÖ•</span>
            </button>
          </div>
        </div>
      </div>

      <div v-if="serverLoading"
        style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 0; gap: 16px;">
        <div class="ag-spinner-elegant"></div>
        <div class="loading-text-elegant">Loading System Config</div>
      </div>

      <div v-else class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th class="text-center" style="width: 80px;">Áä∂ÊÄÅ</th>
              <th>‰∏ªÊú∫ÂêçÁß∞</th>
              <th>ËøûÊé•Âú∞ÂùÄ</th>
              <th class="text-center" style="width: 100px;">ÁõëÊéß</th>
              <th class="text-center">Âª∂Ëøü</th>
              <th class="text-center" style="width: 150px;">Êìç‰Ωú</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="server in serverList" :key="server.id">
              <td class="text-center">
                <div class="flex-cell">
                  <span class="ag-status-badge"
                    :class="server.status === 'online' ? 'ag-status-online' : (server.status === 'offline' ? 'ag-status-error' : 'ag-status-unknown')">
                    {{ server.status === 'online' ? 'Âú®Á∫ø' : (server.status === 'offline' ? 'Á¶ªÁ∫ø' : 'Êú™Áü•') }}
                  </span>
                </div>
              </td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <!-- OS Icon -->
                  <i v-if="server.info && server.info.platform" :class="getOSIcon(server.info.platform)"
                    :style="{ color: getOSColor(server.info.platform), fontSize: '14px', width: '16px', textAlign: 'center' }"></i>
                  <i v-else class="fas fa-server"
                    style="font-size: 12px; color: var(--server-primary); opacity: 0.7;"></i>
                  <strong>{{ server.name }}</strong>
                </div>
              </td>
              <td v-if="server.host && server.host !== '0.0.0.0'">
                <code
                  style="background: var(--bg-secondary); border: 1px solid var(--border-color); padding: 2px 8px; border-radius: 6px; font-size: 11px; font-family: var(--font-mono); color: var(--text-secondary);">
                  {{ formatHost(server.host) }}:{{ server.port }}
                </code>
              </td>
              <td v-else class="text-secondary" style="font-size: 11px; opacity: 0.5;">Êú™Ê£ÄÊµãÂà∞ IP</td>
              <td class="text-center">
                <span
                  style="padding: 4px 12px; font-size: 11px; border-radius: 6px; background: rgba(0, 212, 170, 0.1); color: var(--server-primary); font-weight: 600; display: inline-flex; align-items: center; gap: 4px;">
                  <i class="fas fa-robot" style="font-size: 10px;"></i> Agent
                </span>
              </td>
              <td class="text-center">
                <div v-if="server.response_time" :style="{
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '4px',
                  padding: '2px 10px',
                  borderRadius: '10px',
                  fontSize: '11px',
                  fontWeight: '700',
                  fontFamily: 'var(--font-mono)',
                  background: server.response_time < 100 ? 'rgba(16, 185, 129, 0.1)' : (server.response_time < 300 ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)'),
                  color: server.response_time < 100 ? '#10b981' : (server.response_time < 300 ? '#f59e0b' : '#ef4444')
                }">
                  {{ server.response_time }}ms
                </div>
                <div v-else :style="{
                  display: 'inline-flex',
                  alignItems: 'center',
                  padding: '2px 10px',
                  borderRadius: '10px',
                  fontSize: '11px',
                  fontWeight: '700',
                  fontFamily: 'var(--font-mono)',
                  background: 'rgba(128, 128, 128, 0.08)',
                  color: '#8b949e'
                }">
                  WAIT
                </div>
              </td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button class="btn btn-icon-refined" @click="openSSHTerminal(server)" title="SSH ËøûÊé•"
                    style="color: var(--server-primary);">
                    <i class="fas fa-terminal"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="showAgentInstallModal(server.id)" title="ÈÉ®ÁΩ≤ Agent"
                    style="color: var(--success-color);">
                    <i class="fas fa-robot"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="openEditServerModal(server.id)" title="ÁºñËæë‰∏ªÊú∫">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="rebootServerById(server.id)" title="ÈáçÂêØ‰∏ªÊú∫"
                    style="color: var(--warning-color);">
                    <i class="fas fa-redo"></i>
                  </button>
                  <button class="btn btn-icon-refined" @click="deleteServerById(server.id)" title="Âà†Èô§‰∏ªÊú∫"
                    style="color: var(--danger-color);">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div v-if="serverList.length === 0" class="empty-state">
          <i class="fas fa-server" style="font-size: 48px; margin-bottom: 16px;"></i>
          <div>ÊöÇÊó†‰∏ªÊú∫ÔºåÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†</div>
        </div>
      </div>
    </div>

    <!-- ÊâπÈáèÊ∑ªÂä†‰∏ªÊú∫ -->
    <div class="panel" style="margin-top: 16px;">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-layer-group"
            style="margin-right: 8px; color: var(--server-primary);"></i>ÊâπÈáèÊ∑ªÂä†‰∏ªÊú∫</div>
      </div>
      <div>
        <textarea v-model="serverBatchText" class="form-textarea" placeholder="‰æãÂ¶ÇÔºö
WebÊúçÂä°Âô®,192.168.1.100,22,root,password123
Êï∞ÊçÆÂ∫ìÊúçÂä°Âô®,192.168.1.101,22,root,secure_pass"
          style="min-height: 150px; font-family: var(--font-mono); font-size: 12px; white-space: pre;"></textarea>
        <div v-if="serverBatchError" class="form-error" style="margin-top: 8px;">{{ serverBatchError }}
        </div>
        <div v-if="serverBatchSuccess" class="form-success" style="margin-top: 8px;">{{ serverBatchSuccess
          }}
        </div>
        <button class="btn btn-primary" @click="batchAddServers" :disabled="serverAddingBatch"
          style="width: 100%; margin-top: 12px;">
          {{ serverAddingBatch ? 'Ê∑ªÂä†‰∏≠...' : 'ÊâπÈáèÊ∑ªÂä†' }}
        </button>
      </div>
    </div>

    <!-- Âø´Êç∑ÈÖçÁΩÆ -->
    <div class="panel" style="margin-top: 16px; background: transparent; border: none; box-shadow: none; padding: 0;">
      <div class="secondary-config-row"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 16px;">

        <!-- ‰∏ªÊú∫Âá≠ÊçÆÁÆ°ÁêÜ -->
        <div class="config-card"
          style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; height: 100%;">
          <div class="config-card-title"
            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px dashed var(--border-color); font-weight: 700; color: var(--text-primary); font-size: 14px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div
                style="width: 32px; height: 32px; background: rgba(0, 212, 170, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-shield-alt" style="color: var(--server-primary); font-size: 14px;"></i>
              </div>
              <span>È¢ÑËÆæËÆøÈóÆÂá≠ÊçÆ</span>
            </div>
            <button class="btn btn-primary btn-sm"
              style="padding: 4px 12px; border-radius: 8px; font-size: 11px; background: var(--server-primary); border-color: var(--server-primary);"
              @click="showAddCredentialModal = true">
              <i class="fas fa-plus" style="margin-right: 4px; color: white;"></i>Ê∑ªÂä†Âá≠ÊçÆ
            </button>
          </div>

          <div v-if="serverCredentials.length > 0" class="credential-list"
            style="display: flex; flex-direction: column; gap: 8px; flex: 1; max-height: 200px; overflow-y: auto; padding-right: 4px;">
            <div v-for="cred in serverCredentials" :key="cred.id" class="credential-item"
              style="display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; transition: all 0.2s;"
              :style="{ borderColor: cred.is_default ? 'var(--server-primary)' : 'var(--border-color)', background: cred.is_default ? 'rgba(0, 212, 170, 0.03)' : 'var(--bg-tertiary)' }">
              <div class="cred-info" style="display: flex; align-items: center; gap: 12px;">
                <div v-if="cred.is_default" data-tooltip="ÈªòËÆ§Âá≠ÊçÆ">
                  <i class="fas fa-star" style="color: #f59e0b; font-size: 12px;"></i>
                </div>
                <div v-else style="width: 12px;"></div>
                <div style="display: flex; flex-direction: column; gap: 2px;">
                  <span style="font-weight: 600; font-size: 13px; color: var(--text-primary);">{{ cred.name }}</span>
                  <span style="font-size: 11px; opacity: 0.6; font-family: var(--font-mono);">{{ cred.username }}</span>
                </div>
              </div>
              <div class="cred-actions" style="display: flex; gap: 6px;">
                <button v-if="!cred.is_default" class="btn btn-icon-refined" @click="setDefaultCredential(cred.id)"
                  title="ËÆæ‰∏∫ÈªòËÆ§" style="width: 28px; height: 28px; font-size: 12px;">
                  <i class="far fa-star"></i>
                </button>
                <button class="btn btn-icon-refined" @click="deleteCredential(cred.id)" title="Âà†Èô§"
                  style="width: 28px; height: 28px; font-size: 12px; color: var(--danger-color);">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          <div v-else class="empty-state-mini"
            style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; opacity: 0.5;">
            <i class="fas fa-key" style="font-size: 24px; margin-bottom: 10px; color: var(--server-primary);"></i>
            <div style="font-size: 12px;">ÊöÇÊó†È¢ÑËÆæÂá≠ÊçÆ</div>
          </div>
        </div>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈááÈõÜ -->
        <div class="config-card"
          style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; height: 100%;">
          <div class="config-card-title"
            style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px dashed var(--border-color); font-weight: 700; color: var(--text-primary); font-size: 14px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div
                style="width: 32px; height: 32px; background: rgba(0, 212, 170, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-history" style="color: var(--server-primary); font-size: 14px;"></i>
              </div>
              <span>ÂéÜÂè≤ÊåáÊ†áÈááÈõÜ</span>
            </div>
          </div>

          <div style="flex: 1;">
            <div class="form-group">
              <label
                style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px; display: block; font-weight: 600;">
                Ëá™Âä®ÈááÈõÜÈó¥Èöî
              </label>

              <!-- ËçØÁâáÂºèÈó¥ÈöîÈÄâÊã©Âô® -->
              <div class="interval-pills" style="display: flex; flex-wrap: wrap; gap: 8px;">
                <div v-for="interval in [1, 2, 5, 10, 15, 30, 60]" :key="interval"
                  @click="metricsCollectInterval = interval; updateMetricsCollectInterval()"
                  style="padding: 6px 12px; border-radius: 10px; font-size: 11px; cursor: pointer; border: 1px solid var(--border-color); transition: all 0.2s; font-weight: 600;"
                  :style="{ 
                                      background: metricsCollectInterval === interval ? 'var(--server-primary)' : 'var(--bg-tertiary)',
                                      color: metricsCollectInterval === interval ? 'white' : 'var(--text-secondary)',
                                      borderColor: metricsCollectInterval === interval ? 'var(--server-primary)' : 'var(--border-color)',
                                      boxShadow: metricsCollectInterval === interval ? '0 4px 10px rgba(0, 212, 170, 0.2)' : 'none'
                                    }"> {{ interval >= 60 ? (interval/60 + 'Â∞èÊó∂') : (interval + 'ÂàÜÈíü') }}
                </div>
              </div>

              <div
                style="margin-top: 15px; padding: 12px; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border-color);">
                <label
                  style="font-size: 11px; color: var(--text-tertiary); margin-bottom: 8px; display: block; font-weight: 600;">
                  ÊúÄÂ§ß‰øùÁïôÂ§©Êï∞ ({{ monitorConfig.metrics_retention_days || 30 }} Â§©)
                </label>
                <div style="display: flex; align-items: center; gap: 12px;">
                  <input type="range" v-model="monitorConfig.metrics_retention_days" min="1" max="180" step="1"
                    @change="updateMonitorConfig" style="flex: 1; accent-color: var(--server-primary);">
                  <span style="font-family: var(--font-mono); font-size: 11px; min-width: 30px; text-align: right;">{{
                    monitorConfig.metrics_retention_days || 30 }}d</span>
                </div>
              </div>

              <div
                style="margin-top: 15px; padding: 12px; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border-color);">
                <div v-if="metricsCollectorStatus" style="display: flex; flex-direction: column; gap: 8px;">
                  <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                    <span :class="metricsCollectorStatus.isRunning ? 'status-dot online' : 'status-dot offline'"
                      style="width: 8px; height: 8px;"></span>
                    <span style="font-weight: 600; color: var(--text-primary);">{{ metricsCollectorStatus.isRunning ?
                      'ÈááÈõÜÊúçÂä°ËøêË°å‰∏≠' : 'ÈááÈõÜÊúçÂä°Â∑≤ÂÅúÊ≠¢' }}</span>
                  </div>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 4px;">
                    <div
                      style="font-size: 11px; color: var(--text-tertiary); display: flex; align-items: center; gap: 6px;">
                      <i class="fas fa-database" style="width: 12px;"></i>
                      <span>ÁºìÂ≠ò {{ metricsCollectorStatus.cachedServers }} Âè∞‰∏ªÊú∫</span>
                    </div>
                    <div
                      style="font-size: 11px; color: var(--text-tertiary); display: flex; align-items: center; gap: 6px;">
                      <i class="fas fa-stream" style="width: 12px;"></i>
                      <span>Ê¥ªË∑ÉÊµÅ {{ metricsCollectorStatus.activeStreams }} Êù°</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- SSH ÁªàÁ´ØÂ∏ÉÂ±Ä - ÂµåÂÖ•ÂºèËÆæËÆ° -->
  <div v-show="serverCurrentTab === 'terminal'" class="sub-tab-content ssh-terminal-sub-page">
    <div class="ssh-ide-layout" :class="{ fullscreen: sshIdeFullscreen }">
      <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
      <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
      <div class="ssh-top-bar">
        <!-- ‰ºöËØùÊ†áÁ≠æ -->
        <div class="ssh-session-tabs">
          <div v-for="tab in sshTabList" :key="tab.id" class="ssh-session-tab"
            :class="{ active: tab.isGroup ? tab.active : activeSSHSessionId === tab.id, 'is-group': tab.isGroup, 'is-split': !tab.isGroup && visibleSessionIds.includes(tab.id) }"
            :draggable="!tab.isGroup" @dragstart="tab.isGroup ? null : handleTabDragStart(tab.id, $event)"
            @dragend="handleTabDragEnd"
            @click="tab.isGroup ? switchToSSHTab(tab.sessions[0].id) : switchToSSHTab(tab.id)"
            @dblclick="tab.isGroup ? null : closeSSHSession(tab.id)"
            @mousedown.middle.stop="tab.isGroup ? null : closeSSHSession(tab.id)">

            <span class="ssh-tab-name">{{ tab.name || tab.server.name }}</span>

            <!-- ËÅöÂêàÁªÑÂè≥‰æßÊòæÁ§∫ÂàÜÂ±èÊï∞Èáè -->
            <span v-if="tab.isGroup"
              style="font-size: 10px; opacity: 0.6; background: rgba(var(--primary-rgb), 0.1); padding: 1px 2px; border-radius: 4px; margin-left: 2px;">{{
              tab.sessions.length }}P</span>
          </div>

        </div>

        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <div class="ssh-header-actions" v-if="sshSessions.length > 0">
          <!-- ÈÄÄÂá∫ÂàÜÂ±èÊåâÈíÆ -->
          <button class="ssh-icon-btn" v-if="sshViewLayout !== 'single'" @click="resetToSingleLayout" title="ÈÄÄÂá∫ÂàÜÂ±è">
            <i class="fas fa-th-large"></i>
          </button>
          <!-- ÂêåÊ≠•Êìç‰ΩúÊåâÈíÆ -->
          <button class="ssh-icon-btn" v-if="sshViewLayout !== 'single'" @click="sshSyncEnabled = !sshSyncEnabled"
            :class="{ 'active-primary': sshSyncEnabled }" :title="sshSyncEnabled ? 'ÂÖ≥Èó≠ÂêåÊ≠•Êìç‰Ωú' : 'ÂºÄÂêØÂ§öÂ±èÂêåÊ≠•Êìç‰Ωú'">
            <i class="fas fa-broadcast-tower"></i>
          </button>
          <button class="ssh-icon-btn" @click="showSnippetsSidebar = !showSnippetsSidebar"
            :class="{ 'active-primary': showSnippetsSidebar }" title="‰ª£Á†ÅÁâáÊÆµ">
            <i class="fas fa-code"></i>
          </button>
          <button class="ssh-icon-btn" @click="reconnectSSHSession(activeSSHSessionId)" v-if="currentSSHSession"
            title="ÈáçÊñ∞ËøûÊé•">
            <i class="fas fa-sync-alt"></i>
          </button>
          <button class="ssh-icon-btn" @click="toggleSSHTerminalFullscreen" :title="sshIdeFullscreen ? 'ÈÄÄÂá∫ÂÖ®Â±è' : 'ÂÖ®Â±èÊòæÁ§∫'">
            <i class="fas" :class="sshIdeFullscreen ? 'fa-compress-arrows-alt' : 'fa-expand-arrows-alt'"></i>
          </button>
          <button class="ssh-icon-btn" @click="serverCurrentTab = 'list'" title="ËøîÂõûÂàóË°®">
            <i class="fas fa-arrow-left"></i>
          </button>
          <button class="ssh-icon-btn danger" @click="closeSSHSession(activeSSHSessionId)" v-if="currentSSHSession"
            title="Êñ≠ÂºÄÂπ∂ÂÖ≥Èó≠">
            <i class="fas fa-power-off"></i>
          </button>
        </div>
        <!-- Êó†‰ºöËØùÊó∂ÁöÑÈÄÄÂá∫ÊåâÈíÆ -->
        <div class="ssh-header-actions" v-else>
          <button class="ssh-icon-btn" @click="serverCurrentTab = 'list'" title="ÈÄÄÂá∫ÁªàÁ´Ø">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- ÁªàÁ´Ø‰∏ªÂå∫Âüü (ÂåÖÂê´‰æßËæπÊ†è) -->
      <div class="ssh-main-container" v-if="sshSessions.length > 0">
        <!-- ÁªàÁ´ØÁΩëÊ†ºÂå∫Âüü (Ê†∏ÂøÉ‰øÆÂ§çÔºö‰ΩøÁî® Vue ÁªëÂÆöÂ±ûÊÄßÁ°Æ‰øùÁä∂ÊÄÅÊåÅ‰πÖ) -->
        <div class="ssh-terminal-wrapper" :class="['layout-' + sshViewLayout, { 'dragging-active': draggedSessionId }]"
          :data-pane-count="visibleSessionIds.length" :data-split-side="sshSplitSide"
          @dragover.prevent="handleTerminalDragOver" @dragleave="clearDropHint" @drop="handleTerminalDrop()">

          <!-- ÂÖ®Â±ÄÊîæÁΩÆÈ¢ÑÊèêÁ§∫ (Áî®‰∫éÁ©∫ÁôΩÂå∫ÂüüÊàñÊï¥‰ΩìÂ∏ÉÂ±ÄË∞ÉÊï¥) -->
          <section class="global-drop-hint" :class="{ 'visible': dropHint && !dropTargetId }"
            :style="getGlobalDropHintStyle()"></section>

          <!-- Ê†∏ÂøÉ‰ºòÂåñÔºö‰ΩøÁî®ÈùôÊÄÅÊßΩ‰ΩçÔºà0-8ÔºâÔºåÊîØÊåÅÊúÄÈ´ò 9 ÂàÜÂ±è -->
          <div v-for="index in [0, 1, 2, 3, 4, 5, 6, 7, 8]" :key="'static-slot-' + index"
            v-show="sshViewLayout === 'single' ? index === 0 : index < visibleSessionIds.length"
            class="ssh-terminal-instance"
            :class="{ 'active': activeSSHSessionId === (sshViewLayout === 'single' ? activeSSHSessionId : visibleSessionIds[index]) }"
            @mousedown="sshViewLayout === 'single' ? null : (activeSSHSessionId = visibleSessionIds[index])">

            <div class="ssh-instance-header" v-if="sshViewLayout !== 'single' && visibleSessionIds[index]"
              draggable="true" @dragstart="handleTabDragStart(visibleSessionIds[index], $event)"
              @dragend="handleTabDragEnd">
              <span class="ssh-instance-title">
                <i class="fas fa-terminal"></i> {{ getSessionById(visibleSessionIds[index])?.server.name || 'SSH' }}
              </span>
              <div class="ssh-instance-actions">
                <button class="mini-btn" @click.stop="removeFromSplitView(visibleSessionIds[index])" title="ÂÖ≥Èó≠ÂàÜÂ±è"><i
                    class="fas fa-times"></i></button>
              </div>
            </div>

            <!-- ÊãñÊãΩË¶ÜÁõñÂ±ÇÔºå‰ªÖÂú®ÂàÜÂ±èÊ®°Âºè‰∏îÈùûÂΩìÂâçÊãñÊãΩÈ°πÊó∂ÊòæÁ§∫ -->
            <div class="instance-drop-overlay" v-if="draggedSessionId && draggedSessionId !== visibleSessionIds[index]">
              <div class="drop-zone pos-top" @dragover.prevent.stop="onDropZoneEnter('top', visibleSessionIds[index])"
                @dragleave="onDropZoneLeave" @drop.stop="onDrop(visibleSessionIds[index], 'top')"></div>
              <div class="drop-zone pos-bottom"
                @dragover.prevent.stop="onDropZoneEnter('bottom', visibleSessionIds[index])"
                @dragleave="onDropZoneLeave" @drop.stop="onDrop(visibleSessionIds[index], 'bottom')"></div>
              <div class="drop-zone pos-left" @dragover.prevent.stop="onDropZoneEnter('left', visibleSessionIds[index])"
                @dragleave="onDropZoneLeave" @drop.stop="onDrop(visibleSessionIds[index], 'left')"></div>
              <div class="drop-zone pos-right"
                @dragover.prevent.stop="onDropZoneEnter('right', visibleSessionIds[index])" @dragleave="onDropZoneLeave"
                @drop.stop="onDrop(visibleSessionIds[index], 'right')"></div>
              <div class="drop-zone pos-center"
                @dragover.prevent.stop="onDropZoneEnter('center', visibleSessionIds[index])"
                @dragleave="onDropZoneLeave" @drop.stop="onDrop(visibleSessionIds[index], 'center')"></div>
              <div class="instance-drop-indicator" v-if="dropTargetId === visibleSessionIds[index]"
                :class="'hint-' + dropHint">
                <span v-if="dropHint === 'center'">ÊõøÊç¢</span><span v-else>ÊãÜÂàÜ</span>
              </div>
            </div>

            <!-- ÈùôÊÄÅÁ¥¢ÂºïÊßΩ‰Ωç -->
            <div :id="'ssh-slot-idx-' + index" class="ssh-slot"></div>
          </div>
        </div>

        <!-- ‰ª£Á†ÅÁâáÊÆµ‰æßËæπÊ†è -->
        <transition name="slide-right">
          <div class="ssh-snippets-sidebar" v-if="showSnippetsSidebar">
            <div class="sidebar-header">
              <span><i class="fas fa-code"></i> ‰ª£Á†ÅÁâáÊÆµ</span>
              <button class="mini-btn-primary" @click="openAddSnippetModal" title="Ê∑ªÂä†ÁâáÊÆµ">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="snippets-list">
              <div v-for="snippet in sshSnippets" :key="snippet.id" class="snippet-item"
                @click="sendSnippet(snippet.content)">
                <div class="snippet-info">
                  <div class="snippet-title">{{ snippet.title }}</div>
                  <div class="snippet-category" v-if="snippet.category">{{ snippet.category }}</div>
                </div>
                <div class="snippet-actions">
                  <button class="btn-icon-refined sm" @click.stop="openEditSnippetModal(snippet)"><i
                      class="fas fa-edit"></i></button>
                  <button class="btn-icon-refined sm" style="color: var(--danger-color);"
                    @click.stop="deleteSnippet(snippet.id)"><i class="fas fa-trash"></i></button>
                </div>
              </div>
              <div v-if="sshSnippets.length === 0" class="empty-text">
                <i class="fas fa-terminal"
                  style="opacity: 0.2; font-size: 24px; display: block; margin-bottom: 8px;"></i>
                ÊöÇÊó†‰ª£Á†ÅÁâáÊÆµ
              </div>
            </div>
          </div>
        </transition>
      </div>

      <!-- Á©∫Áä∂ÊÄÅÊ¨¢ËøéÈ°µ -->
      <div v-else class="ssh-welcome-screen">
        <div class="ssh-welcome-icon">
          <i class="fas fa-terminal"></i>
        </div>
        <div class="ssh-welcome-text">ÈÄâÊã©‰∏Ä‰∏™‰ºöËØùÊàñÊñ∞Âª∫ËøûÊé•</div>
        <button class="btn btn-primary" @click="showAddSessionModal">
          <i class="fas fa-plus"></i> Êñ∞Âª∫‰ºöËØù
        </button>
      </div>
    </div>
  </div>

  <!-- ‰ª£Á†ÅÁâáÊÆµÁºñËæëÊ®°ÊÄÅÊ°Ü -->
  <transition name="modal-fade">
    <div v-if="showSnippetModal" class="modal-overlay" @click.self="showSnippetModal = false">
      <div class="modal modal-sm">
        <div class="modal-header">
          <div class="modal-title">{{ snippetForm.id ? 'ÁºñËæë‰ª£Á†ÅÁâáÊÆµ' : 'Ê∑ªÂä†‰ª£Á†ÅÁâáÊÆµ' }}</div>
          <button class="close-btn" @click="showSnippetModal = false"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Ê†áÈ¢ò</label>
            <input v-model="snippetForm.title" class="form-input" placeholder="‰æãÂ¶ÇÔºöÊõ¥Êñ∞Á≥ªÁªü" />
          </div>
          <div class="form-group">
            <label>ÂÜÖÂÆπ (Êåá‰ª§)</label>
            <textarea v-model="snippetForm.content" class="form-textarea code-font" style="min-height: 120px;"
              placeholder="apt update && apt upgrade -y"></textarea>
            <small style="color: var(--text-tertiary);">ÊèêÁ§∫ÔºöÊåá‰ª§‰ºöËá™Âä®ËøΩÂä†ÂõûËΩ¶ÈîÆÂèëÈÄÅ</small>
          </div>
          <div class="form-row">
            <div class="form-group flex-1">
              <label>ÂàÜÁ±ª</label>
              <input v-model="snippetForm.category" class="form-input" placeholder="common" />
            </div>
          </div>
          <div v-if="snippetError" class="form-error">{{ snippetError }}</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" @click="showSnippetModal = false">ÂèñÊ∂à</button>
          <button class="btn btn-primary" @click="saveSnippet" :disabled="snippetSaving">
            {{ snippetSaving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò' }}
          </button>
        </div>
      </div>
    </div>
  </transition>

</div>
<!-- ==================== ‰∏ªÊú∫ÁÆ°ÁêÜÈÉ®ÂàÜÁªìÊùü ==================== -->