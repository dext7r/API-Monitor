<div class="tab-content dns-tab-content theme-cf-dns" :class="getTabAnimationClass('dns')">
  <!-- DNS 子标签页 -->
  <div class="sec-tabs">
    <button
      class="tab-btn"
      :class="{ active: dnsCurrentTab === 'dns' }"
      @click="dnsCurrentTab = 'dns'"
    >
      <i class="fas fa-globe"></i> DNS 记录
    </button>
    <button
      class="tab-btn"
      :class="{ active: dnsCurrentTab === 'compute' }"
      @click="dnsCurrentTab = 'compute'; computeCurrentTab === 'workers' ? loadWorkers() : loadPages()"
    >
      <i class="fas fa-microchip"></i> 计算
    </button>
    <button
      class="tab-btn"
      :class="{ active: dnsCurrentTab === 'r2' }"
      @click="dnsCurrentTab = 'r2'; loadBuckets()"
    >
      <i class="fas fa-archive"></i> R2 存储
    </button>
    <button
      class="tab-btn"
      :class="{ active: dnsCurrentTab === 'accounts' }"
      @click="dnsCurrentTab = 'accounts'"
    >
      <i class="fas fa-users"></i> 账号管理
    </button>
  </div>

  <!-- R2 存储内容 (直接内联) -->
  <div id="r2-module" v-show="dnsCurrentTab === 'r2'" class="r2-container quick-fade-in">
    <!-- 1. 存储桶列表视图 -->
    <div v-if="!r2SelectedBucketName" class="buckets-view">
      <div class="panel-header" style="margin-bottom: 20px">
        <div class="panel-title">
          <i class="fas fa-archive" style="margin-right: 8px; color: var(--cf-color)"></i>
          R2 存储桶
        </div>
        <div class="panel-actions">
          <button @click="showR2CreateBucketModal = true" class="btn btn-primary btn-sm">
            <i class="fas fa-plus"></i> 创建存储桶
          </button>
        </div>
      </div>

      <!-- 加载中 -->
      <div v-if="r2LoadingBuckets" class="loading-state">
        <i class="fas fa-circle-notch fa-spin"></i>
        <span>正在加载 R2 存储桶...</span>
      </div>

      <!-- 存储桶网格 -->
      <div v-else-if="r2Buckets.length > 0" class="r2-buckets-grid">
        <div
          v-for="bucket in r2Buckets"
          :key="bucket.name"
          @click="selectBucket(bucket.name)"
          class="r2-bucket-card"
          style="position: relative"
        >
          <!-- 右上角删除按钮 -->
          <button
            @click.stop="deleteBucket(bucket.name)"
            class="btn btn-icon btn-sm btn-text-danger"
            title="删除存储桶"
            style="position: absolute; top: 8px; right: 8px; opacity: 0.6"
          >
            <i class="fas fa-trash"></i>
          </button>
          <div class="r2-bucket-icon">
            <i class="fas fa-database"></i>
          </div>
          <div class="r2-bucket-info">
            <div class="r2-bucket-name">{{ bucket.name }}</div>
            <div class="r2-bucket-date">创建于: {{ formatDate(bucket.creation_date) }}</div>
          </div>
        </div>
      </div>

      <!-- 空状态 -->
      <div v-else class="r2-empty">
        <i class="fas fa-archive"></i>
        <p>暂无存储桶，点击上方按钮创建一个吧</p>
      </div>
    </div>

    <!-- 2. 对象浏览器视图 -->
    <div v-else class="browser-view">
      <div class="panel-header" style="margin-bottom: 20px">
        <div class="panel-title" @click="r2SelectedBucketName = null" style="cursor: pointer">
          <i
            class="fas fa-chevron-left"
            style="margin-right: 12px; font-size: 14px; opacity: 0.6"
          ></i>
          <i class="fas fa-database" style="margin-right: 8px; color: var(--cf-color)"></i>
          {{ r2SelectedBucketName }}
        </div>
        <div class="panel-actions">
          <button
            @click="loadObjects"
            class="btn btn-secondary btn-sm"
            :disabled="r2LoadingObjects"
          >
            <i class="fas fa-sync" :class="{'fa-spin': r2LoadingObjects}"></i> 刷新
          </button>
        </div>
      </div>

      <div class="r2-browser">
        <div class="r2-browser-header">
          <!-- 面包屑导航 -->
          <div class="r2-breadcrumb">
            <div class="r2-breadcrumb-item" @click="navigateTo(-1)">
              <i class="fas fa-home"></i> 根目录
            </div>
            <template v-for="(part, index) in r2CurrentPrefix.split('/').filter(p => p !== '')">
              <span class="r2-breadcrumb-separator">/</span>
              <div class="r2-breadcrumb-item" @click="navigateTo(index)">{{ part }}</div>
            </template>
          </div>

          <div class="r2-browser-actions">
            <div class="r2-search-container">
              <i class="fas fa-search r2-search-icon"></i>
              <input
                type="text"
                v-model="r2SearchText"
                placeholder="搜索对象..."
                class="r2-search-input"
              />
            </div>
            <!-- 批量删除按钮 -->
            <button
              v-if="r2SelectedObjects.length > 0"
              @click="batchDeleteR2Objects"
              class="btn btn-danger btn-sm"
              style="margin-left: 12px"
            >
              <i class="fas fa-trash"></i> 删除 ({{ r2SelectedObjects.length }})
            </button>
          </div>
        </div>

        <!-- 加载状态 -->
        <div v-if="r2LoadingObjects" class="loading-state" style="padding: 40px">
          <i class="fas fa-circle-notch fa-spin"></i>
          <span>正在加载对象...</span>
        </div>

        <!-- 对象列表 -->
        <table v-else class="r2-table">
          <thead>
            <tr>
              <th style="width: 40px">
                <input
                  type="checkbox"
                  :checked="r2SelectedObjects.length > 0 && r2SelectedObjects.length === r2Objects.filter(o => !o.isFolder).length"
                  @change="toggleSelectAllR2Objects($event.target.checked)"
                  title="全选"
                />
              </th>
              <th>名称</th>
              <th>大小</th>
              <th>修改日期</th>
              <th style="width: 80px">操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- 返回上一级 (如果不在根目录) -->
            <tr v-if="r2CurrentPrefix" @click="navigateBack" style="cursor: pointer">
              <td></td>
              <td>
                <div class="r2-object-name-cell">
                  <i
                    class="fas fa-level-up-alt r2-object-icon"
                    style="color: var(--text-secondary)"
                  ></i>
                  <span>..</span>
                </div>
              </td>
              <td>-</td>
              <td>-</td>
              <td></td>
            </tr>

            <!-- 过滤后的列表 -->
            <tr
              v-for="obj in r2Objects.filter(o => !r2SearchText || o.name.toLowerCase().includes(r2SearchText.toLowerCase()))"
              :key="obj.key"
              :class="{'r2-row-selected': r2SelectedObjects.includes(obj.key)}"
            >
              <td @click.stop>
                <input
                  v-if="!obj.isFolder"
                  type="checkbox"
                  :checked="r2SelectedObjects.includes(obj.key)"
                  @change="toggleR2ObjectSelection(obj.key, $event.target.checked)"
                />
              </td>
              <td
                @click="obj.isFolder ? enterFolder(obj.key) : null"
                :style="obj.isFolder ? 'cursor: pointer;' : ''"
              >
                <div class="r2-object-name-cell">
                  <i :class="getFileIcon(obj)" class="r2-object-icon"></i>
                  <span>{{ obj.name }}</span>
                </div>
              </td>
              <td class="r2-object-size">{{ obj.isFolder ? '-' : formatSize(obj.size) }}</td>
              <td class="r2-object-date">
                {{ obj.isFolder ? '-' : formatDate(obj.last_modified) }}
              </td>
              <td>
                <div v-if="!obj.isFolder" class="r2-row-actions" style="display: flex; gap: 4px">
                  <button
                    @click="downloadR2Object(obj)"
                    class="btn btn-icon btn-sm"
                    title="下载文件"
                  >
                    <i class="fas fa-download"></i>
                  </button>
                  <button
                    @click="deleteR2Object(obj.key)"
                    class="btn btn-icon btn-sm btn-text-danger"
                    title="删除文件"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <!-- 无匹配结果 -->
            <tr v-if="r2Objects.length === 0">
              <td colspan="5" class="r2-empty" style="padding: 40px">
                <i class="fas fa-folder-open"></i>
                <p>此文件夹为空</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 创建存储桶弹窗 -->
    <div
      v-if="showR2CreateBucketModal"
      class="modal-backdrop"
      @click.self="showR2CreateBucketModal = false"
    >
      <div class="modal-content quick-fade-in" style="max-width: 400px">
        <div class="modal-header">
          <div class="modal-title">创建新存储桶</div>
          <button @click="showR2CreateBucketModal = false" class="btn-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>存储桶名称</label>
            <input
              type="text"
              v-model="newR2BucketName"
              placeholder="例如: my-assets"
              class="input-control"
              autofocus
            />
            <p class="form-help">名称必须是全局唯一的，且仅包含小写字母、数字和连字符</p>
          </div>
        </div>
        <div class="modal-footer">
          <button @click="showR2CreateBucketModal = false" class="btn btn-secondary">取消</button>
          <button
            @click="createBucket(newR2BucketName).then(ok => ok && (showR2CreateBucketModal=false))"
            class="btn btn-primary"
            :disabled="!newR2BucketName"
          >
            确认创建
          </button>
        </div>
      </div>
    </div>

    <!-- R2 自定义域名输入弹窗 -->
    <div v-if="showR2DomainModal" class="modal-overlay" @click.self="cancelR2DomainInput">
      <div class="modal quick-fade-in" style="max-width: 480px">
        <div class="modal-header">
          <div class="modal-title">
            <i class="fas fa-link" style="margin-right: 8px; color: var(--cf-color)"></i>
            配置公开访问域名
          </div>
          <button @click="cancelR2DomainInput" class="modal-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">存储桶</label>
            <div
              style="
                background: var(--bg-tertiary);
                padding: 10px 14px;
                border-radius: 8px;
                font-family: var(--font-mono);
                font-size: 13px;
              "
            >
              {{ r2SelectedBucketName }}
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">公开访问域名</label>
            <input
              type="text"
              v-model="r2CustomDomainInput"
              placeholder="https://pub-xxxx.r2.dev"
              class="form-input"
              @keyup.enter="confirmR2DomainInput"
              autofocus
            />
            <p class="form-help" style="margin-top: 8px">
              <i class="fas fa-info-circle"></i> 支持的格式：
            </p>
            <ul class="form-help" style="margin: 4px 0 0 20px; font-size: 12px; opacity: 0.8">
              <li><code>https://pub-xxxx.r2.dev</code> - R2 自动生成的公开域名</li>
              <li><code>https://cdn.example.com</code> - 自定义域名</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button @click="cancelR2DomainInput" class="btn btn-secondary">取消</button>
          <button
            @click="confirmR2DomainInput"
            class="btn btn-primary"
            :disabled="!r2CustomDomainInput"
          >
            <i class="fas fa-save"></i> 保存并下载
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- DNS 记录标签页 -->
  <div v-if="dnsCurrentTab === 'dns'" class="sub-tab-content quick-fade-in">
    <!-- 账号选择 - 卡片式 -->
    <div style="margin-bottom: 16px" v-if="dnsAccounts.length > 1">
      <div class="zones-grid">
        <div
          v-for="acc in dnsAccounts"
          :key="acc.id"
          class="zone-card"
          :class="{ active: dnsSelectedAccountId === acc.id }"
          @click="selectDnsAccount(acc)"
        >
          <div style="flex: 1">
            <div class="zone-name">
              <i class="fas fa-user-circle" style="margin-right: 6px; color: var(--cf-color)"></i>
              {{ acc.name }}
            </div>
            <div class="zone-status" style="font-size: 11px">{{ acc.email || '账号' }}</div>
          </div>
          <div style="display: flex; align-items: center; gap: 8px">
            <i
              v-if="dnsSelectedAccountId === acc.id"
              class="fas fa-check-circle"
              style="color: var(--cf-color)"
            ></i>
            <button
              v-if="dnsSelectedAccountId === acc.id"
              class="btn btn-secondary"
              style="padding: 4px 8px; font-size: 12px"
              @click.stop="loadDnsZones"
              :disabled="dnsLoadingZones"
            >
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': dnsLoadingZones }"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 域名操作按钮 -->
    <div
      v-if="dnsSelectedAccountId && !dnsLoadingZones"
      style="margin-bottom: 16px; display: flex; gap: 8px"
    >
      <button class="btn btn-success" style="padding: 6px 12px" @click="openAddZoneModal">
        <i class="fas fa-plus"></i> 添加域名
      </button>
      <button
        v-if="dnsSelectedZoneId"
        class="btn btn-danger"
        style="padding: 6px 12px"
        @click="deleteZone"
      >
        <i class="fas fa-trash"></i> 删除域名
      </button>
      <button
        v-if="dnsSelectedZoneId"
        class="btn btn-secondary"
        style="padding: 6px 12px"
        @click="showSslModal = true"
      >
        <i class="fas fa-shield-alt"></i> SSL: {{ formatSslMode(dnsSelectedZoneSsl?.mode) }}
      </button>
    </div>

    <div v-if="dnsLoadingZones" class="loading">
      <div class="spinner"></div>
      <div style="margin-top: 12px">加载域名列表...</div>
    </div>

    <!-- 域名网格 -->
    <div v-if="dnsSelectedAccountId && dnsZones.length > 0 && !dnsLoadingZones" class="zones-grid">
      <div
        v-for="zone in dnsZones"
        :key="zone.id"
        class="zone-card"
        :class="{ active: dnsSelectedZoneId === zone.id }"
        @click="selectDnsZone(zone)"
      >
        <div style="flex: 1">
          <div class="zone-name">{{ zone.name }}</div>
          <div class="zone-status" :class="zone.status">{{ zone.status }}</div>
        </div>
        <i class="fas fa-chevron-right" style="color: var(--text-tertiary)"></i>
      </div>
    </div>

    <div
      v-if="dnsSelectedAccountId && dnsZones.length === 0 && !dnsLoadingZones"
      class="empty-state"
    >
      <i class="fas fa-globe" style="font-size: 48px; margin-bottom: 16px"></i>
      <div>该账号下没有域名</div>
    </div>

    <!-- 快速切换 -->
    <div v-if="dnsSelectedZoneId" class="quick-switch">
      <i class="fas fa-bolt" style="color: var(--cf-color)"></i>
      <span style="font-weight: 500; white-space: nowrap">快速切换：</span>
      <select
        v-model="dnsQuickSwitchType"
        style="
          color: #f38020;
          padding: 6px 10px;
          border-radius: 4px;
          border: 1px solid var(--input-border);
          background: var(--input-bg);
          min-width: 80px;
        "
      >
        <option value="A">A</option>
        <option value="AAAA">AAAA</option>
        <option value="CNAME">CNAME</option>
      </select>
      <input v-model="dnsQuickSwitchName" placeholder="记录名称 (如 @, www, *)" />
      <input v-model="dnsQuickSwitchContent" placeholder="新的内容 (IP 或域名)" />
      <button
        class="btn btn-cf"
        style="padding: 6px 12px"
        @click="dnsQuickSwitch"
        :disabled="dnsSwitching"
      >
        {{ dnsSwitching ? '切换中...' : '切换' }}
      </button>
    </div>

    <!-- Analytics 仪表板（暂时隐藏，待完善） -->
    <div
      v-if="false && dnsSelectedZoneId && dnsSelectedZoneAnalytics"
      class="analytics-card quick-fade-in"
    >
      <div class="analytics-header">
        <div class="analytics-title">
          <i class="fas fa-chart-bar"></i>
          <span>Analytics</span>
          <span class="analytics-time-badge">{{ dnsAnalyticsTimeRange }}</span>
        </div>
        <div class="analytics-controls">
          <div class="analytics-time-selector">
            <button
              v-for="range in ['24h', '7d', '30d']"
              :key="range"
              @click="loadZoneAnalytics(range)"
              :class="['time-btn', { active: dnsAnalyticsTimeRange === range }]"
              :disabled="dnsLoadingAnalytics"
            >
              {{ range }}
            </button>
          </div>
          <button
            @click="loadZoneAnalytics(dnsAnalyticsTimeRange)"
            class="refresh-btn"
            :disabled="dnsLoadingAnalytics"
            title="刷新数据"
          >
            <i class="fas fa-sync" :class="{ 'fa-spin': dnsLoadingAnalytics }"></i>
          </button>
        </div>
      </div>

      <div class="analytics-metrics">
        <div class="metric">
          <i class="fas fa-chart-line"></i>
          <div class="metric-info">
            <span class="metric-value">{{ formatNumber(dnsSelectedZoneAnalytics.requests) }}</span>
            <span class="metric-label">请求</span>
          </div>
        </div>
        <div class="metric">
          <i class="fas fa-database"></i>
          <div class="metric-info">
            <span class="metric-value">{{ formatBytes(dnsSelectedZoneAnalytics.bandwidth) }}</span>
            <span class="metric-label">带宽</span>
          </div>
        </div>
        <div class="metric">
          <i class="fas fa-shield-alt"></i>
          <div class="metric-info">
            <span class="metric-value">{{ formatNumber(dnsSelectedZoneAnalytics.threats) }}</span>
            <span class="metric-label">威胁</span>
          </div>
        </div>
        <div class="metric">
          <i class="fas fa-bolt"></i>
          <div class="metric-info">
            <span class="metric-value">{{ dnsSelectedZoneAnalytics.cacheHitRate }}%</span>
            <span class="metric-label">缓存</span>
          </div>
        </div>
      </div>
    </div>

    <!-- DNS 记录表格 -->
    <div v-if="dnsSelectedZoneId" class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <i class="fas fa-list-alt" style="margin-right: 8px; color: var(--cf-color)"></i>DNS
          记录列表
        </div>
        <div class="panel-actions-group dns-header-controls">
          <!-- NS 记录按钮 -->
          <div style="position: relative">
            <button
              class="btn btn-secondary paas-control-btn"
              style="padding: 6px 12px"
              @click="toggleNsPopover"
              title="查看 NS 记录"
            >
              <i class="fas fa-server"></i> <span>NS</span>
            </button>
            <div v-if="showNsPopover" class="ns-popover quick-fade-in">
              <div
                style="
                  font-size: 12px;
                  font-weight: 600;
                  color: var(--text-secondary);
                  margin-bottom: 8px;
                "
              >
                Name Servers
              </div>
              <!-- 调试信息 -->
              <div
                style="
                  font-size: 11px;
                  color: var(--text-tertiary);
                  margin-bottom: 8px;
                  padding: 6px;
                  background: var(--bg-secondary);
                  border-radius: 4px;
                "
              >
                域名: {{ dnsSelectedZoneName || '未选择' }} | NS数量: {{ dnsSelectedZoneNameServers
                ? dnsSelectedZoneNameServers.length : 0 }}
              </div>
              <div v-if="dnsSelectedZoneNameServers && dnsSelectedZoneNameServers.length > 0">
                <div
                  v-for="ns in dnsSelectedZoneNameServers"
                  :key="ns"
                  @click.stop="copyToClipboard(ns)"
                  class="ns-item"
                >
                  <span>{{ ns }}</span>
                  <i class="fas fa-copy"></i>
                </div>
              </div>
              <div v-else style="font-size: 12px; color: var(--text-tertiary)">暂无记录</div>
            </div>
            <!-- 背景遮罩层 -->
            <div v-if="showNsPopover" class="popover-overlay" @click="toggleNsPopover"></div>
          </div>

          <!-- 清除缓存按钮 -->
          <button
            class="btn btn-warning paas-control-btn"
            style="padding: 6px 12px"
            @click="purgeZoneCache"
            :disabled="dnsPurgingCache"
            title="清除全部缓存"
          >
            <i class="fas" :class="dnsPurgingCache ? 'fa-spinner fa-spin' : 'fa-broom'"></i>
            <span>清缓存</span>
          </button>

          <button
            class="btn btn-success paas-control-btn"
            style="padding: 6px 12px"
            @click="openAddDnsRecordModal"
            title="添加记录"
          >
            <i class="fas fa-plus"></i> <span>添加</span>
          </button>
          <button
            v-if="dnsSelectedRecords.length > 0"
            class="btn btn-danger paas-control-btn"
            style="padding: 6px 12px"
            @click="batchDeleteDnsRecords"
            title="批量删除"
          >
            <i class="fas fa-trash-alt"></i> <span>删除</span> ({{ dnsSelectedRecords.length }})
          </button>
          <button
            class="btn btn-secondary paas-control-btn"
            style="padding: 6px 12px"
            @click="exportDnsRecords"
            title="导出记录"
          >
            <i class="fas fa-upload"></i> <span>导出</span>
          </button>
          <button
            class="btn btn-secondary paas-control-btn"
            style="padding: 6px 12px"
            @click="importDnsRecords"
            title="导入记录"
          >
            <i class="fas fa-download"></i> <span>导入</span>
          </button>
        </div>
      </div>

      <div v-if="dnsLoadingRecords" class="loading">
        <div class="spinner"></div>
        <div style="margin-top: 12px">加载中...</div>
      </div>

      <div v-else class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width: 5%" class="text-center">
                <div class="flex-cell">
                  <input
                    type="checkbox"
                    @change="toggleSelectAllDnsRecords"
                    :checked="dnsSelectedRecords.length === dnsRecords.length && dnsRecords.length > 0"
                    style="width: 16px; height: 16px; cursor: pointer"
                  />
                </div>
              </th>
              <th style="width: 12%" class="text-center">类型</th>
              <th style="width: 18%">名称</th>
              <th style="width: 28%">内容</th>
              <th style="width: 8%" class="text-center">代理</th>
              <th style="width: 8%" class="text-center">TTL</th>
              <th style="width: 10%" class="text-center">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="record in dnsRecords" :key="record.id">
              <td class="text-center">
                <div class="flex-cell">
                  <input
                    type="checkbox"
                    :value="record.id"
                    v-model="dnsSelectedRecords"
                    style="width: 16px; height: 16px; cursor: pointer"
                  />
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span class="record-type" :class="record.type">{{ record.type }}</span>
                </div>
              </td>
              <td>
                <div
                  v-if="!record.isEditingName"
                  class="editable-cell"
                  :title="formatDnsRecordName(record.name) + ' (双击编辑)'"
                  @dblclick="startEditDnsName(record)"
                >
                  {{ formatDnsRecordName(record.name) }}
                </div>
                <div v-else class="inline-edit-container" @click.stop>
                  <input
                    v-model="record.editingName"
                    class="inline-edit-input"
                    @keyup.enter="saveDnsName(record)"
                    @keyup.esc="cancelEditDnsName(record)"
                    @blur="saveDnsName(record)"
                    ref="dnsNameInput"
                  />
                  <button
                    @click.stop="cancelEditDnsName(record)"
                    class="inline-edit-cancel"
                    title="取消"
                  >
                    ✖️
                  </button>
                </div>
              </td>
              <td>
                <div
                  v-if="!record.isEditingContent"
                  class="content-truncate editable-cell"
                  :title="record.content + ' (双击编辑)'"
                  @dblclick="startEditDnsContent(record)"
                >
                  {{ record.content }}
                </div>
                <div v-else class="inline-edit-container" @click.stop>
                  <input
                    v-model="record.editingContent"
                    class="inline-edit-input"
                    @keyup.enter="saveDnsContent(record)"
                    @keyup.esc="cancelEditDnsContent(record)"
                    @blur="saveDnsContent(record)"
                    ref="dnsContentInput"
                  />
                  <button
                    @click.stop="cancelEditDnsContent(record)"
                    class="inline-edit-cancel"
                    title="取消"
                  >
                    ✖️
                  </button>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span
                    class="proxied-badge"
                    :class="record.proxied ? 'proxied-on' : 'proxied-off'"
                  >
                    {{ record.proxied ? '开启' : '关闭' }}
                  </span>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span class="ttl-badge" style="font-family: var(--font-mono)"
                    >{{ record.ttl === 1 ? 'Auto' : record.ttl }}</span
                  >
                </div>
              </td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button
                    class="btn btn-icon-refined"
                    @click="editDnsRecord(record)"
                    title="编辑记录"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-icon-refined"
                    @click="deleteDnsRecord(record)"
                    title="删除记录"
                    style="color: var(--danger-color)"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div v-if="dnsRecords.length === 0" class="empty-state">暂无 DNS 记录</div>
      </div>
    </div>
  </div>

  <!-- 计算标签页 (Workers + Pages) -->
  <div v-if="dnsCurrentTab === 'compute'" class="sub-tab-content quick-fade-in">
    <!-- 账号选择 - 卡片式 -->
    <div style="margin-bottom: 16px" v-if="dnsAccounts.length > 1">
      <div class="zones-grid">
        <div
          v-for="acc in dnsAccounts"
          :key="acc.id"
          class="zone-card"
          :class="{ active: dnsSelectedAccountId === acc.id }"
          @click="selectDnsAccount(acc); computeCurrentTab === 'workers' ? loadWorkers() : loadPages()"
        >
          <div style="flex: 1">
            <div class="zone-name">
              <i class="fas fa-user-circle" style="margin-right: 6px; color: var(--cf-color)"></i>
              {{ acc.name }}
            </div>
            <div class="zone-status" style="font-size: 11px">{{ acc.email || '账号' }}</div>
          </div>
          <div
            v-if="dnsSelectedAccountId === acc.id"
            style="display: flex; align-items: center; gap: 8px"
          >
            <i class="fas fa-check-circle" style="color: var(--cf-color)"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- 计算二级标签页 -->
    <div class="compute-inner-tabs" style="margin-bottom: 16px; display: flex; gap: 8px">
      <button
        class="btn"
        :class="computeCurrentTab === 'workers' ? 'btn-cf' : 'btn-secondary'"
        @click="if (computeCurrentTab !== 'workers') { computeCurrentTab = 'workers'; loadWorkers(); }"
      >
        <i class="fas fa-bolt"></i> Workers
      </button>
      <button
        class="btn"
        :class="computeCurrentTab === 'pages' ? 'btn-cf' : 'btn-secondary'"
        @click="if (computeCurrentTab !== 'pages') { computeCurrentTab = 'pages'; loadPages(); }"
      >
        <i class="fas fa-file-code"></i> Pages
      </button>
    </div>

    <!-- Workers 内容 -->
    <div v-if="computeCurrentTab === 'workers'">
      <!-- 有账号时始终显示面板 -->
      <div v-if="dnsSelectedAccountId" class="panel">
        <div class="panel-header">
          <div class="panel-title">
            Cloudflare Workers
            <span
              v-if="workersSubdomain"
              style="font-size: 12px; font-weight: normal; margin-left: 12px; opacity: 0.7"
            >
              子域名: <code class="code-sm">{{ workersSubdomain }}.workers.dev</code>
            </span>
          </div>
          <div style="display: flex; gap: 8px">
            <button class="btn btn-success" @click="openNewWorkerModal">
              <i class="fas fa-plus"></i> 新建 Worker
            </button>
            <button class="btn btn-secondary" @click="loadWorkers">
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': workersLoading }"></i> 刷新
            </button>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>名称</th>
                <th>子域名地址</th>
                <th class="text-center">创建时间</th>
                <th class="text-center">更新时间</th>
                <th class="text-center" style="width: 180px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="worker in workers" :key="worker.id">
                <td>
                  <div style="font-weight: 600; color: var(--cf-color)">{{ worker.name }}</div>
                </td>
                <td>
                  <div v-if="workersSubdomain" class="content-truncate" style="opacity: 0.8">
                    <a
                      href="javascript:void(0)"
                      @click="openExternalLink(worker.name + '.' + workersSubdomain + '.workers.dev')"
                      style="color: inherit; text-decoration: none"
                    >
                      {{ worker.name }}.{{ workersSubdomain }}.workers.dev
                      <i
                        class="fas fa-external-link-alt"
                        style="font-size: 10px; margin-left: 4px"
                      ></i>
                    </a>
                  </div>
                  <span v-else style="opacity: 0.4">-</span>
                </td>
                <td class="text-center">
                  <div class="log-time">{{ formatWorkerDate(worker.createdOn) }}</div>
                </td>
                <td class="text-center">
                  <div class="log-time">{{ formatWorkerDate(worker.modifiedOn) }}</div>
                </td>
                <td class="actions text-center">
                  <div class="flex-cell">
                    <button
                      class="btn btn-icon-refined"
                      title="本地编辑代码"
                      @click="openEditWorkerModal(worker)"
                    >
                      <i class="fas fa-code"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="在 Cloudflare 官网打开"
                      @click="openExternalLink('https://dash.cloudflare.com/' + workersCfAccountId + '/workers/services/edit/' + worker.name + '/production')"
                    >
                      <i class="fab fa-cloudflare"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="路由管理"
                      @click="openWorkerRoutesModal(worker)"
                    >
                      <i class="fas fa-route"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="自定义域名"
                      @click="openWorkerDomainsModal(worker)"
                    >
                      <i class="fas fa-globe"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="删除"
                      @click="deleteWorker(worker.name)"
                      style="color: var(--danger-color)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div v-if="workers.length === 0" class="empty-state">
            <i class="fas fa-bolt" style="font-size: 48px; margin-bottom: 16px; opacity: 0.2"></i>
            <div>暂无 Workers，点击按钮新建一个</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pages 内容 -->
    <div v-if="computeCurrentTab === 'pages'">
      <!-- 有账号时始终显示面板 -->
      <div v-if="dnsSelectedAccountId" class="panel">
        <div class="panel-header">
          <div class="panel-title">Cloudflare Pages</div>
          <div style="display: flex; gap: 8px">
            <button
              class="btn btn-cf"
              @click="openExternalLink('https://dash.cloudflare.com/' + workersCfAccountId + '/pages/new')"
            >
              <i class="fas fa-plus"></i> 新建项目
            </button>
            <button class="btn btn-secondary" @click="loadPages">
              <i class="fas fa-sync-alt" :class="{ 'fa-spin': pagesLoading }"></i> 刷新
            </button>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>项目名称</th>
                <th>部署域名</th>
                <th>来源</th>
                <th class="text-center">更新时间</th>
                <th class="text-center" style="width: 180px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="project in pagesProjects" :key="project.id">
                <td>
                  <div style="font-weight: 600; color: var(--cf-color)">{{ project.name }}</div>
                </td>
                <td>
                  <div class="content-truncate" style="opacity: 0.8">
                    <a
                      href="javascript:void(0)"
                      @click="openExternalLink(project.subdomain)"
                      style="color: var(--cf-color); text-decoration: none"
                    >
                      {{ project.subdomain }}
                      <i
                        class="fas fa-external-link-alt"
                        style="font-size: 10px; margin-left: 4px"
                      ></i>
                    </a>
                  </div>
                </td>
                <td>
                  <div v-if="project.source" style="font-size: 12px">
                    <i
                      :class="project.source.type === 'github' ? 'fab fa-github' : 'fas fa-code-branch'"
                      style="margin-right: 4px"
                    ></i>
                    {{ project.source.config?.owner }}/{{ project.source.config?.repo_name }}
                  </div>
                  <span v-else style="opacity: 0.4">直接上传</span>
                </td>
                <td class="text-center">
                  <div
                    class="log-time"
                    :title="project.latestDeployment ? '最新部署时间' : '创建时间'"
                  >
                    {{ formatWorkerDate(project.latestDeployment?.createdOn || project.created_on)
                    }}
                  </div>
                </td>
                <td class="actions text-center">
                  <div class="flex-cell">
                    <button
                      class="btn btn-icon-refined"
                      title="查看部署"
                      @click="viewPagesDeployments(project)"
                    >
                      <i class="fas fa-history"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="自定义域名"
                      @click="openPagesDomainsModal(project)"
                    >
                      <i class="fas fa-globe"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="控制台"
                      @click="openExternalLink('https://dash.cloudflare.com/' + workersCfAccountId + '/pages/view/' + project.name)"
                    >
                      <i class="fas fa-external-link-square-alt"></i>
                    </button>
                    <button
                      class="btn btn-icon-refined"
                      title="删除"
                      @click="deletePagesProject(project)"
                      style="color: var(--danger-color)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div v-if="pagesProjects.length === 0" class="empty-state">
            <i
              class="fas fa-file-code"
              style="font-size: 48px; margin-bottom: 16px; opacity: 0.2"
            ></i>
            <div>暂无 Pages 项目</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CF 账号管理标签页 -->
  <div v-if="dnsCurrentTab === 'accounts'" class="sub-tab-content quick-fade-in">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <i class="fas fa-users" style="margin-right: 8px; color: var(--cf-color)"></i>Cloudflare
          账号管理
        </div>
        <div style="display: flex; gap: 8px">
          <button class="btn btn-success" style="padding: 6px 12px" @click="openAddDnsAccountModal">
            <i class="fas fa-plus"></i> 添加账号
          </button>
          <button class="btn btn-secondary" style="padding: 6px 12px" @click="exportDnsAccounts">
            <i class="fas fa-upload"></i> 导出
          </button>
          <button class="btn btn-secondary" style="padding: 6px 12px" @click="importDnsAccounts">
            <i class="fas fa-download"></i> 导入
          </button>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>名称</th>
              <th>邮箱</th>
              <th>API Token</th>
              <th class="text-center">添加时间</th>
              <th class="text-center">最后使用</th>
              <th style="width: 150px" class="text-center">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="acc in dnsAccounts" :key="acc.id">
              <td>
                <div style="display: flex; align-items: center; gap: 8px">
                  <i
                    class="fas fa-user-circle"
                    style="font-size: 12px; color: var(--cf-color); opacity: 0.7"
                  ></i>
                  <strong>{{ acc.name }}</strong>
                </div>
              </td>
              <td>{{ acc.email || '-' }}</td>
              <td>
                <div style="display: flex; align-items: center; gap: 8px">
                  <code
                    style="
                      background: var(--bg-secondary);
                      border: 1px solid var(--border-color);
                      padding: 2px 8px;
                      border-radius: 6px;
                      font-size: 11px;
                      font-family: var(--font-mono);
                      color: var(--text-secondary);
                    "
                  >
                    {{ acc.showToken ? acc.apiToken : (acc.hasToken ? '••••••••••••••••' : '-') }}
                  </code>
                  <button
                    v-if="acc.hasToken"
                    class="copy-btn"
                    @click="toggleDnsTokenVisibility(acc)"
                    :title="acc.showToken ? '隐藏' : '显示'"
                    style="padding: 2px 4px"
                  >
                    <i :class="acc.showToken ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                  </button>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <div class="log-time">{{ formatDnsDate(acc.createdAt) }}</div>
                </div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <div class="log-time" v-if="acc.lastUsed">{{ formatDnsDate(acc.lastUsed) }}</div>
                  <span v-else style="color: var(--text-tertiary); font-size: 11px"
                    >从未有效调用</span
                  >
                </div>
              </td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button
                    class="btn btn-icon-refined"
                    @click="verifyDnsAccount(acc)"
                    title="验证 Token 有效性"
                  >
                    <i class="fas fa-shield-alt"></i>
                  </button>
                  <button
                    class="btn btn-icon-refined"
                    @click="editDnsAccount(acc)"
                    title="编辑账号"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-icon-refined"
                    @click="deleteDnsAccount(acc)"
                    title="删除账号"
                    style="color: var(--danger-color)"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div v-if="dnsAccounts.length === 0" class="empty-state">
          <i class="fas fa-key" style="font-size: 48px; margin-bottom: 16px"></i>
          <div>
            暂无账号，请添加 Cloudflare API Token
            <br />
            <br />
            <b>【高级功能请使用Global token】</b>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 模板标签页 -->
  <div v-if="dnsCurrentTab === 'templates'">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <i class="fas fa-file-code" style="margin-right: 8px; color: var(--cf-color)"></i>DNS 模板
        </div>
        <button class="btn btn-success" style="padding: 6px 12px" @click="openAddDnsTemplateModal">
          <i class="fas fa-plus"></i> 添加模板
        </button>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>名称</th>
              <th style="width: 60px">类型</th>
              <th>内容</th>
              <th style="width: 70px" class="text-center">代理</th>
              <th>描述</th>
              <th style="width: 120px" class="text-center">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="tpl in dnsTemplates" :key="tpl.id">
              <td>{{ tpl.name }}</td>
              <td><span class="record-type" :class="tpl.type">{{ tpl.type }}</span></td>
              <td>
                <div class="content-truncate" :title="tpl.content">{{ tpl.content }}</div>
              </td>
              <td class="text-center">
                <div class="flex-cell">
                  <span class="proxied-badge" :class="tpl.proxied ? 'proxied-on' : 'proxied-off'">
                    {{ tpl.proxied ? '开启' : '关闭' }}
                  </span>
                </div>
              </td>
              <td>{{ tpl.description || '-' }}</td>
              <td class="actions text-center">
                <div class="flex-cell">
                  <button
                    class="btn btn-icon-refined"
                    @click="editDnsTemplate(tpl)"
                    title="编辑模板"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-icon-refined"
                    @click="deleteDnsTemplate(tpl)"
                    title="删除模板"
                    style="color: var(--danger-color)"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div v-if="dnsTemplates.length === 0" class="empty-state">
          <i class="fas fa-copy" style="font-size: 48px; margin-bottom: 16px"></i>
          <div>暂无模板，添加常用 DNS 配置模板以快速应用</div>
        </div>
      </div>
    </div>
  </div>
  <!-- 关闭 tab-content -->
</div>
<!-- 关闭 theme-cf-dns -->

<!-- SSL 模式选择模态框 (绝对顶层) -->
<transition name="modal-fade">
  <div
    v-if="showSslModal"
    class="modal-overlay"
    @click="showSslModal = false"
    style="z-index: 9999"
  >
    <div class="modal ssl-modal modal-sm" @click.stop>
      <div class="modal-header">
        <div class="modal-title">SSL/TLS 加密模式</div>
        <button class="close-btn" @click="showSslModal = false">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div v-if="dnsLoadingSsl" class="loading" style="padding: 30px">
          <div class="spinner-sm"></div>
          <p style="margin-top: 15px; font-size: 13px; color: var(--text-secondary)">
            正在获取当前配置...
          </p>
        </div>
        <div
          v-else-if="dnsSelectedZoneSsl"
          class="ssl-mode-btn-group"
          style="flex-direction: column; gap: 10px"
        >
          <button
            @click="updateSslMode('off'); showSslModal = false"
            :class="['ssl-mode-btn', { active: dnsSelectedZoneSsl.mode === 'off' }]"
            style="flex-direction: column; align-items: flex-start; padding: 12px; height: auto"
          >
            <div style="font-weight: 700; font-size: 14px">关闭 (Off)</div>
            <div style="font-size: 11px; opacity: 0.7; margin-top: 2px">
              不加密，仅通过 HTTP 访问
            </div>
          </button>
          <button
            @click="updateSslMode('flexible'); showSslModal = false"
            :class="['ssl-mode-btn', { active: dnsSelectedZoneSsl.mode === 'flexible' }]"
            style="flex-direction: column; align-items: flex-start; padding: 12px; height: auto"
          >
            <div style="font-weight: 700; font-size: 14px">灵活 (Flexible)</div>
            <div style="font-size: 11px; opacity: 0.7; margin-top: 2px">
              浏览器到 Cloudflare 加密，源站不加密
            </div>
          </button>
          <button
            @click="updateSslMode('full'); showSslModal = false"
            :class="['ssl-mode-btn', { active: dnsSelectedZoneSsl.mode === 'full' }]"
            style="flex-direction: column; align-items: flex-start; padding: 12px; height: auto"
          >
            <div style="font-weight: 700; font-size: 14px">完全 (Full)</div>
            <div style="font-size: 11px; opacity: 0.7; margin-top: 2px">
              全程加密，源站证书可以是自签名证书
            </div>
          </button>
          <button
            @click="updateSslMode('strict'); showSslModal = false"
            :class="['ssl-mode-btn', { active: dnsSelectedZoneSsl.mode === 'strict' }]"
            style="flex-direction: column; align-items: flex-start; padding: 12px; height: auto"
          >
            <div style="font-weight: 700; font-size: 14px">严格 (Full Strict)</div>
            <div style="font-size: 11px; opacity: 0.7; margin-top: 2px">
              全程加密，源站必须安装有效的 CA 证书
            </div>
          </button>
        </div>
        <div v-else class="error-state" style="padding: 30px; text-align: center">
          <i
            class="fas fa-exclamation-circle"
            style="font-size: 28px; color: var(--danger-color); margin-bottom: 12px"
          ></i>
          <p style="color: var(--text-secondary)">获取当前配置失败，请关闭重试</p>
        </div>
      </div>
    </div>
  </div>
</transition>
